\doxysection{bt\+Sequential\+Impulse\+Constraint\+Solver.\+cpp}
\hypertarget{bt_sequential_impulse_constraint_solver_8cpp_source}{}\label{bt_sequential_impulse_constraint_solver_8cpp_source}\index{C:/Users/Usuario/Documents/pruebas-\/c/Practica Animación/libraries/bullet-\/3.17/src/BulletDynamics/ConstraintSolver/btSequentialImpulseConstraintSolver.cpp@{C:/Users/Usuario/Documents/pruebas-\/c/Practica Animación/libraries/bullet-\/3.17/src/BulletDynamics/ConstraintSolver/btSequentialImpulseConstraintSolver.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{Bullet\ Continuous\ Collision\ Detection\ and\ Physics\ Library}}
\DoxyCodeLine{00003\ \textcolor{comment}{Copyright\ (c)\ 2003-\/2006\ Erwin\ Coumans\ \ http://continuousphysics.com/Bullet/}}
\DoxyCodeLine{00004\ \textcolor{comment}{}}
\DoxyCodeLine{00005\ \textcolor{comment}{This\ software\ is\ provided\ 'as-\/is',\ without\ any\ express\ or\ implied\ warranty.}}
\DoxyCodeLine{00006\ \textcolor{comment}{In\ no\ event\ will\ the\ authors\ be\ held\ liable\ for\ any\ damages\ arising\ from\ the\ use\ of\ this\ software.}}
\DoxyCodeLine{00007\ \textcolor{comment}{Permission\ is\ granted\ to\ anyone\ to\ use\ this\ software\ for\ any\ purpose,}}
\DoxyCodeLine{00008\ \textcolor{comment}{including\ commercial\ applications,\ and\ to\ alter\ it\ and\ redistribute\ it\ freely,}}
\DoxyCodeLine{00009\ \textcolor{comment}{subject\ to\ the\ following\ restrictions:}}
\DoxyCodeLine{00010\ \textcolor{comment}{}}
\DoxyCodeLine{00011\ \textcolor{comment}{1.\ The\ origin\ of\ this\ software\ must\ not\ be\ misrepresented;\ you\ must\ not\ claim\ that\ you\ wrote\ the\ original\ software.\ If\ you\ use\ this\ software\ in\ a\ product,\ an\ acknowledgment\ in\ the\ product\ documentation\ would\ be\ appreciated\ but\ is\ not\ required.}}
\DoxyCodeLine{00012\ \textcolor{comment}{2.\ Altered\ source\ versions\ must\ be\ plainly\ marked\ as\ such,\ and\ must\ not\ be\ misrepresented\ as\ being\ the\ original\ software.}}
\DoxyCodeLine{00013\ \textcolor{comment}{3.\ This\ notice\ may\ not\ be\ removed\ or\ altered\ from\ any\ source\ distribution.}}
\DoxyCodeLine{00014\ \textcolor{comment}{*/}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{comment}{//\#define\ COMPUTE\_IMPULSE\_DENOM\ 1}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifdef\ BT\_DEBUG}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#\ \ \ define\ BT\_ADDITIONAL\_DEBUG}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{//It\ is\ not\ necessary\ (redundant)\ to\ refresh\ contact\ manifolds,\ this\ refresh\ has\ been\ moved\ to\ the\ collision\ algorithms.}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}btSequentialImpulseConstraintSolver.h"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}BulletCollision/NarrowPhaseCollision/btPersistentManifold.h"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btIDebugDraw.h"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btCpuFeatureUtility.h"{}}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{comment}{//\#include\ "{}btJacobianEntry.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btMinMax.h"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}BulletDynamics/ConstraintSolver/btTypedConstraint.h"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <new>}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btStackAlloc.h"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btQuickprof.h"{}}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\#include\ "{}btSolverBody.h"{}}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\#include\ "{}btSolverConstraint.h"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btAlignedObjectArray.h"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <string.h>}\ \ \textcolor{comment}{//for\ memset}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keywordtype}{int}\ gNumSplitImpulseRecoveries\ =\ 0;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}BulletDynamics/Dynamics/btRigidBody.h"{}}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{comment}{//\#define\ VERBOSE\_RESIDUAL\_PRINTF\ 1}}
\DoxyCodeLine{00047\ \textcolor{keyword}{static}\ btScalar\ gResolveSingleConstraintRowGeneric\_scalar\_reference(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00048\ \{}
\DoxyCodeLine{00049\ \ \ \ \ btScalar\ deltaImpulse\ =\ c.m\_rhs\ -\/\ btScalar(c.m\_appliedImpulse)\ *\ c.m\_cfm;}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ deltaVel1Dotn\ =\ c.m\_contactNormal1.dot(bodyA.internalGetDeltaLinearVelocity())\ +\ c.m\_relpos1CrossNormal.dot(bodyA.internalGetDeltaAngularVelocity());}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ deltaVel2Dotn\ =\ c.m\_contactNormal2.dot(bodyB.internalGetDeltaLinearVelocity())\ +\ c.m\_relpos2CrossNormal.dot(bodyB.internalGetDeltaAngularVelocity());}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ \ const\ btScalar\ delta\_rel\_vel\ \ \ \ =\ \ \ deltaVel1Dotn-\/deltaVel2Dotn;}}
\DoxyCodeLine{00054\ \ \ \ \ deltaImpulse\ -\/=\ deltaVel1Dotn\ *\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00055\ \ \ \ \ deltaImpulse\ -\/=\ deltaVel2Dotn\ *\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ sum\ =\ btScalar(c.m\_appliedImpulse)\ +\ deltaImpulse;}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{if}\ (sum\ <\ c.m\_lowerLimit)}
\DoxyCodeLine{00059\ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ deltaImpulse\ =\ c.m\_lowerLimit\ -\/\ c.m\_appliedImpulse;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ c.m\_appliedImpulse\ =\ c.m\_lowerLimit;}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sum\ >\ c.m\_upperLimit)}
\DoxyCodeLine{00064\ \ \ \ \ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ deltaImpulse\ =\ c.m\_upperLimit\ -\/\ c.m\_appliedImpulse;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ c.m\_appliedImpulse\ =\ c.m\_upperLimit;}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00069\ \ \ \ \ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ c.m\_appliedImpulse\ =\ sum;}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ bodyA.internalApplyImpulse(c.m\_contactNormal1\ *\ bodyA.internalGetInvMass(),\ c.m\_angularComponentA,\ deltaImpulse);}
\DoxyCodeLine{00074\ \ \ \ \ bodyB.internalApplyImpulse(c.m\_contactNormal2\ *\ bodyB.internalGetInvMass(),\ c.m\_angularComponentB,\ deltaImpulse);}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImpulse\ *\ (1.\ /\ c.m\_jacDiagABInv);}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{keyword}{static}\ btScalar\ gResolveSingleConstraintRowLowerLimit\_scalar\_reference(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00080\ \{}
\DoxyCodeLine{00081\ \ \ \ \ btScalar\ deltaImpulse\ =\ c.m\_rhs\ -\/\ btScalar(c.m\_appliedImpulse)\ *\ c.m\_cfm;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ deltaVel1Dotn\ =\ c.m\_contactNormal1.dot(bodyA.internalGetDeltaLinearVelocity())\ +\ c.m\_relpos1CrossNormal.dot(bodyA.internalGetDeltaAngularVelocity());}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ deltaVel2Dotn\ =\ c.m\_contactNormal2.dot(bodyB.internalGetDeltaLinearVelocity())\ +\ c.m\_relpos2CrossNormal.dot(bodyB.internalGetDeltaAngularVelocity());}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ deltaImpulse\ -\/=\ deltaVel1Dotn\ *\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00086\ \ \ \ \ deltaImpulse\ -\/=\ deltaVel2Dotn\ *\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ sum\ =\ btScalar(c.m\_appliedImpulse)\ +\ deltaImpulse;}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{if}\ (sum\ <\ c.m\_lowerLimit)}
\DoxyCodeLine{00089\ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ deltaImpulse\ =\ c.m\_lowerLimit\ -\/\ c.m\_appliedImpulse;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ c.m\_appliedImpulse\ =\ c.m\_lowerLimit;}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00094\ \ \ \ \ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ c.m\_appliedImpulse\ =\ sum;}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \ \ bodyA.internalApplyImpulse(c.m\_contactNormal1\ *\ bodyA.internalGetInvMass(),\ c.m\_angularComponentA,\ deltaImpulse);}
\DoxyCodeLine{00098\ \ \ \ \ bodyB.internalApplyImpulse(c.m\_contactNormal2\ *\ bodyB.internalGetInvMass(),\ c.m\_angularComponentB,\ deltaImpulse);}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImpulse\ *\ (1.\ /\ c.m\_jacDiagABInv);}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#ifdef\ USE\_SIMD}}
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#include\ <emmintrin.h>}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#define\ btVecSplat(x,\ e)\ \_mm\_shuffle\_ps(x,\ x,\ \_MM\_SHUFFLE(e,\ e,\ e,\ e))}}
\DoxyCodeLine{00107\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \_\_m128\ btSimdDot3(\_\_m128\ vec0,\ \_\_m128\ vec1)}
\DoxyCodeLine{00108\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \_\_m128\ result\ =\ \_mm\_mul\_ps(vec0,\ vec1);}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{return}\ \_mm\_add\_ps(btVecSplat(result,\ 0),\ \_mm\_add\_ps(btVecSplat(result,\ 1),\ btVecSplat(result,\ 2)));}
\DoxyCodeLine{00111\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#if\ defined(BT\_ALLOW\_SSE4)}}
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#include\ <intrin.h>}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#define\ USE\_FMA\ 1}}
\DoxyCodeLine{00117\ \textcolor{preprocessor}{\#define\ USE\_FMA3\_INSTEAD\_FMA4\ 1}}
\DoxyCodeLine{00118\ \textcolor{preprocessor}{\#define\ USE\_SSE4\_DOT\ 1}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\#define\ SSE4\_DP(a,\ b)\ \_mm\_dp\_ps(a,\ b,\ 0x7f)}}
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\#define\ SSE4\_DP\_FP(a,\ b)\ \_mm\_cvtss\_f32(\_mm\_dp\_ps(a,\ b,\ 0x7f))}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\#if\ USE\_SSE4\_DOT}}
\DoxyCodeLine{00124\ \textcolor{preprocessor}{\#define\ DOT\_PRODUCT(a,\ b)\ SSE4\_DP(a,\ b)}}
\DoxyCodeLine{00125\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#define\ DOT\_PRODUCT(a,\ b)\ btSimdDot3(a,\ b)}}
\DoxyCodeLine{00127\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#if\ USE\_FMA}}
\DoxyCodeLine{00130\ \textcolor{preprocessor}{\#if\ USE\_FMA3\_INSTEAD\_FMA4}}
\DoxyCodeLine{00131\ \textcolor{comment}{//\ a*b\ +\ c}}
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\#define\ FMADD(a,\ b,\ c)\ \_mm\_fmadd\_ps(a,\ b,\ c)}}
\DoxyCodeLine{00133\ \textcolor{comment}{//\ -\/(a*b)\ +\ c}}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#define\ FMNADD(a,\ b,\ c)\ \_mm\_fnmadd\_ps(a,\ b,\ c)}}
\DoxyCodeLine{00135\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ USE\_FMA3}}
\DoxyCodeLine{00136\ \textcolor{comment}{//\ a*b\ +\ c}}
\DoxyCodeLine{00137\ \textcolor{preprocessor}{\#define\ FMADD(a,\ b,\ c)\ \_mm\_macc\_ps(a,\ b,\ c)}}
\DoxyCodeLine{00138\ \textcolor{comment}{//\ -\/(a*b)\ +\ c}}
\DoxyCodeLine{00139\ \textcolor{preprocessor}{\#define\ FMNADD(a,\ b,\ c)\ \_mm\_nmacc\_ps(a,\ b,\ c)}}
\DoxyCodeLine{00140\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00141\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ USE\_FMA}}
\DoxyCodeLine{00142\ \textcolor{comment}{//\ c\ +\ a*b}}
\DoxyCodeLine{00143\ \textcolor{preprocessor}{\#define\ FMADD(a,\ b,\ c)\ \_mm\_add\_ps(c,\ \_mm\_mul\_ps(a,\ b))}}
\DoxyCodeLine{00144\ \textcolor{comment}{//\ c\ -\/\ a*b}}
\DoxyCodeLine{00145\ \textcolor{preprocessor}{\#define\ FMNADD(a,\ b,\ c)\ \_mm\_sub\_ps(c,\ \_mm\_mul\_ps(a,\ b))}}
\DoxyCodeLine{00146\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00147\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \textcolor{comment}{//\ Project\ Gauss\ Seidel\ or\ the\ equivalent\ Sequential\ Impulse}}
\DoxyCodeLine{00150\ \textcolor{keyword}{static}\ btScalar\ gResolveSingleConstraintRowGeneric\_sse2(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00151\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \_\_m128\ cpAppliedImp\ =\ \_mm\_set1\_ps(c.m\_appliedImpulse);}
\DoxyCodeLine{00153\ \ \ \ \ \_\_m128\ lowerLimit1\ =\ \_mm\_set1\_ps(c.m\_lowerLimit);}
\DoxyCodeLine{00154\ \ \ \ \ \_\_m128\ upperLimit1\ =\ \_mm\_set1\_ps(c.m\_upperLimit);}
\DoxyCodeLine{00155\ \ \ \ \ btSimdScalar\ deltaImpulse\ =\ \_mm\_sub\_ps(\_mm\_set1\_ps(c.m\_rhs),\ \_mm\_mul\_ps(\_mm\_set1\_ps(c.m\_appliedImpulse),\ \_mm\_set1\_ps(c.m\_cfm)));}
\DoxyCodeLine{00156\ \ \ \ \ \_\_m128\ deltaVel1Dotn\ =\ \_mm\_add\_ps(btSimdDot3(c.m\_contactNormal1.mVec128,\ bodyA.internalGetDeltaLinearVelocity().mVec128),\ btSimdDot3(c.m\_relpos1CrossNormal.mVec128,\ bodyA.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00157\ \ \ \ \ \_\_m128\ deltaVel2Dotn\ =\ \_mm\_add\_ps(btSimdDot3(c.m\_contactNormal2.mVec128,\ bodyB.internalGetDeltaLinearVelocity().mVec128),\ btSimdDot3(c.m\_relpos2CrossNormal.mVec128,\ bodyB.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00158\ \ \ \ \ deltaImpulse\ =\ \_mm\_sub\_ps(deltaImpulse,\ \_mm\_mul\_ps(deltaVel1Dotn,\ \_mm\_set1\_ps(c.m\_jacDiagABInv)));}
\DoxyCodeLine{00159\ \ \ \ \ deltaImpulse\ =\ \_mm\_sub\_ps(deltaImpulse,\ \_mm\_mul\_ps(deltaVel2Dotn,\ \_mm\_set1\_ps(c.m\_jacDiagABInv)));}
\DoxyCodeLine{00160\ \ \ \ \ btSimdScalar\ sum\ =\ \_mm\_add\_ps(cpAppliedImp,\ deltaImpulse);}
\DoxyCodeLine{00161\ \ \ \ \ btSimdScalar\ resultLowerLess,\ resultUpperLess;}
\DoxyCodeLine{00162\ \ \ \ \ resultLowerLess\ =\ \_mm\_cmplt\_ps(sum,\ lowerLimit1);}
\DoxyCodeLine{00163\ \ \ \ \ resultUpperLess\ =\ \_mm\_cmplt\_ps(sum,\ upperLimit1);}
\DoxyCodeLine{00164\ \ \ \ \ \_\_m128\ lowMinApplied\ =\ \_mm\_sub\_ps(lowerLimit1,\ cpAppliedImp);}
\DoxyCodeLine{00165\ \ \ \ \ deltaImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultLowerLess,\ lowMinApplied),\ \_mm\_andnot\_ps(resultLowerLess,\ deltaImpulse));}
\DoxyCodeLine{00166\ \ \ \ \ c.m\_appliedImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultLowerLess,\ lowerLimit1),\ \_mm\_andnot\_ps(resultLowerLess,\ sum));}
\DoxyCodeLine{00167\ \ \ \ \ \_\_m128\ upperMinApplied\ =\ \_mm\_sub\_ps(upperLimit1,\ cpAppliedImp);}
\DoxyCodeLine{00168\ \ \ \ \ deltaImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultUpperLess,\ deltaImpulse),\ \_mm\_andnot\_ps(resultUpperLess,\ upperMinApplied));}
\DoxyCodeLine{00169\ \ \ \ \ c.m\_appliedImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultUpperLess,\ c.m\_appliedImpulse),\ \_mm\_andnot\_ps(resultUpperLess,\ upperLimit1));}
\DoxyCodeLine{00170\ \ \ \ \ \_\_m128\ linearComponentA\ =\ \_mm\_mul\_ps(c.m\_contactNormal1.mVec128,\ bodyA.internalGetInvMass().mVec128);}
\DoxyCodeLine{00171\ \ \ \ \ \_\_m128\ linearComponentB\ =\ \_mm\_mul\_ps((c.m\_contactNormal2).mVec128,\ bodyB.internalGetInvMass().mVec128);}
\DoxyCodeLine{00172\ \ \ \ \ \_\_m128\ impulseMagnitude\ =\ deltaImpulse;}
\DoxyCodeLine{00173\ \ \ \ \ bodyA.internalGetDeltaLinearVelocity().mVec128\ =\ \_mm\_add\_ps(bodyA.internalGetDeltaLinearVelocity().mVec128,\ \_mm\_mul\_ps(linearComponentA,\ impulseMagnitude));}
\DoxyCodeLine{00174\ \ \ \ \ bodyA.internalGetDeltaAngularVelocity().mVec128\ =\ \_mm\_add\_ps(bodyA.internalGetDeltaAngularVelocity().mVec128,\ \_mm\_mul\_ps(c.m\_angularComponentA.mVec128,\ impulseMagnitude));}
\DoxyCodeLine{00175\ \ \ \ \ bodyB.internalGetDeltaLinearVelocity().mVec128\ =\ \_mm\_add\_ps(bodyB.internalGetDeltaLinearVelocity().mVec128,\ \_mm\_mul\_ps(linearComponentB,\ impulseMagnitude));}
\DoxyCodeLine{00176\ \ \ \ \ bodyB.internalGetDeltaAngularVelocity().mVec128\ =\ \_mm\_add\_ps(bodyB.internalGetDeltaAngularVelocity().mVec128,\ \_mm\_mul\_ps(c.m\_angularComponentB.mVec128,\ impulseMagnitude));}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImpulse.m\_floats[0]\ /\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00178\ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \textcolor{comment}{//\ Enhanced\ version\ of\ gResolveSingleConstraintRowGeneric\_sse2\ with\ SSE4.1\ and\ FMA3}}
\DoxyCodeLine{00181\ \textcolor{keyword}{static}\ btScalar\ gResolveSingleConstraintRowGeneric\_sse4\_1\_fma3(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00182\ \{}
\DoxyCodeLine{00183\ \textcolor{preprocessor}{\#if\ defined(BT\_ALLOW\_SSE4)}}
\DoxyCodeLine{00184\ \ \ \ \ \_\_m128\ tmp\ =\ \_mm\_set\_ps1(c.m\_jacDiagABInv);}
\DoxyCodeLine{00185\ \ \ \ \ \_\_m128\ deltaImpulse\ =\ \_mm\_set\_ps1(c.m\_rhs\ -\/\ btScalar(c.m\_appliedImpulse)\ *\ c.m\_cfm);}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ lowerLimit\ =\ \_mm\_set\_ps1(c.m\_lowerLimit);}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ upperLimit\ =\ \_mm\_set\_ps1(c.m\_upperLimit);}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ deltaVel1Dotn\ =\ \_mm\_add\_ps(DOT\_PRODUCT(c.m\_contactNormal1.mVec128,\ bodyA.internalGetDeltaLinearVelocity().mVec128),\ DOT\_PRODUCT(c.m\_relpos1CrossNormal.mVec128,\ bodyA.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ deltaVel2Dotn\ =\ \_mm\_add\_ps(DOT\_PRODUCT(c.m\_contactNormal2.mVec128,\ bodyB.internalGetDeltaLinearVelocity().mVec128),\ DOT\_PRODUCT(c.m\_relpos2CrossNormal.mVec128,\ bodyB.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00190\ \ \ \ \ deltaImpulse\ =\ FMNADD(deltaVel1Dotn,\ tmp,\ deltaImpulse);}
\DoxyCodeLine{00191\ \ \ \ \ deltaImpulse\ =\ FMNADD(deltaVel2Dotn,\ tmp,\ deltaImpulse);}
\DoxyCodeLine{00192\ \ \ \ \ tmp\ =\ \_mm\_add\_ps(c.m\_appliedImpulse,\ deltaImpulse);\ \ \textcolor{comment}{//\ sum}}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ maskLower\ =\ \_mm\_cmpgt\_ps(tmp,\ lowerLimit);}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ maskUpper\ =\ \_mm\_cmpgt\_ps(upperLimit,\ tmp);}
\DoxyCodeLine{00195\ \ \ \ \ deltaImpulse\ =\ \_mm\_blendv\_ps(\_mm\_sub\_ps(lowerLimit,\ c.m\_appliedImpulse),\ \_mm\_blendv\_ps(\_mm\_sub\_ps(upperLimit,\ c.m\_appliedImpulse),\ deltaImpulse,\ maskUpper),\ maskLower);}
\DoxyCodeLine{00196\ \ \ \ \ c.m\_appliedImpulse\ =\ \_mm\_blendv\_ps(lowerLimit,\ \_mm\_blendv\_ps(upperLimit,\ tmp,\ maskUpper),\ maskLower);}
\DoxyCodeLine{00197\ \ \ \ \ bodyA.internalGetDeltaLinearVelocity().mVec128\ =\ FMADD(\_mm\_mul\_ps(c.m\_contactNormal1.mVec128,\ bodyA.internalGetInvMass().mVec128),\ deltaImpulse,\ bodyA.internalGetDeltaLinearVelocity().mVec128);}
\DoxyCodeLine{00198\ \ \ \ \ bodyA.internalGetDeltaAngularVelocity().mVec128\ =\ FMADD(c.m\_angularComponentA.mVec128,\ deltaImpulse,\ bodyA.internalGetDeltaAngularVelocity().mVec128);}
\DoxyCodeLine{00199\ \ \ \ \ bodyB.internalGetDeltaLinearVelocity().mVec128\ =\ FMADD(\_mm\_mul\_ps(c.m\_contactNormal2.mVec128,\ bodyB.internalGetInvMass().mVec128),\ deltaImpulse,\ bodyB.internalGetDeltaLinearVelocity().mVec128);}
\DoxyCodeLine{00200\ \ \ \ \ bodyB.internalGetDeltaAngularVelocity().mVec128\ =\ FMADD(c.m\_angularComponentB.mVec128,\ deltaImpulse,\ bodyB.internalGetDeltaAngularVelocity().mVec128);}
\DoxyCodeLine{00201\ \ \ \ \ btSimdScalar\ deltaImp\ =\ deltaImpulse;}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImp.m\_floats[0]\ *\ (1.\ /\ c.m\_jacDiagABInv);}
\DoxyCodeLine{00203\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowGeneric\_sse2(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00205\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00206\ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \textcolor{keyword}{static}\ btScalar\ gResolveSingleConstraintRowLowerLimit\_sse2(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00209\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \_\_m128\ cpAppliedImp\ =\ \_mm\_set1\_ps(c.m\_appliedImpulse);}
\DoxyCodeLine{00211\ \ \ \ \ \_\_m128\ lowerLimit1\ =\ \_mm\_set1\_ps(c.m\_lowerLimit);}
\DoxyCodeLine{00212\ \ \ \ \ \_\_m128\ upperLimit1\ =\ \_mm\_set1\_ps(c.m\_upperLimit);}
\DoxyCodeLine{00213\ \ \ \ \ btSimdScalar\ deltaImpulse\ =\ \_mm\_sub\_ps(\_mm\_set1\_ps(c.m\_rhs),\ \_mm\_mul\_ps(\_mm\_set1\_ps(c.m\_appliedImpulse),\ \_mm\_set1\_ps(c.m\_cfm)));}
\DoxyCodeLine{00214\ \ \ \ \ \_\_m128\ deltaVel1Dotn\ =\ \_mm\_add\_ps(btSimdDot3(c.m\_contactNormal1.mVec128,\ bodyA.internalGetDeltaLinearVelocity().mVec128),\ btSimdDot3(c.m\_relpos1CrossNormal.mVec128,\ bodyA.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00215\ \ \ \ \ \_\_m128\ deltaVel2Dotn\ =\ \_mm\_add\_ps(btSimdDot3(c.m\_contactNormal2.mVec128,\ bodyB.internalGetDeltaLinearVelocity().mVec128),\ btSimdDot3(c.m\_relpos2CrossNormal.mVec128,\ bodyB.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00216\ \ \ \ \ deltaImpulse\ =\ \_mm\_sub\_ps(deltaImpulse,\ \_mm\_mul\_ps(deltaVel1Dotn,\ \_mm\_set1\_ps(c.m\_jacDiagABInv)));}
\DoxyCodeLine{00217\ \ \ \ \ deltaImpulse\ =\ \_mm\_sub\_ps(deltaImpulse,\ \_mm\_mul\_ps(deltaVel2Dotn,\ \_mm\_set1\_ps(c.m\_jacDiagABInv)));}
\DoxyCodeLine{00218\ \ \ \ \ btSimdScalar\ sum\ =\ \_mm\_add\_ps(cpAppliedImp,\ deltaImpulse);}
\DoxyCodeLine{00219\ \ \ \ \ btSimdScalar\ resultLowerLess,\ resultUpperLess;}
\DoxyCodeLine{00220\ \ \ \ \ resultLowerLess\ =\ \_mm\_cmplt\_ps(sum,\ lowerLimit1);}
\DoxyCodeLine{00221\ \ \ \ \ resultUpperLess\ =\ \_mm\_cmplt\_ps(sum,\ upperLimit1);}
\DoxyCodeLine{00222\ \ \ \ \ \_\_m128\ lowMinApplied\ =\ \_mm\_sub\_ps(lowerLimit1,\ cpAppliedImp);}
\DoxyCodeLine{00223\ \ \ \ \ deltaImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultLowerLess,\ lowMinApplied),\ \_mm\_andnot\_ps(resultLowerLess,\ deltaImpulse));}
\DoxyCodeLine{00224\ \ \ \ \ c.m\_appliedImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultLowerLess,\ lowerLimit1),\ \_mm\_andnot\_ps(resultLowerLess,\ sum));}
\DoxyCodeLine{00225\ \ \ \ \ \_\_m128\ linearComponentA\ =\ \_mm\_mul\_ps(c.m\_contactNormal1.mVec128,\ bodyA.internalGetInvMass().mVec128);}
\DoxyCodeLine{00226\ \ \ \ \ \_\_m128\ linearComponentB\ =\ \_mm\_mul\_ps(c.m\_contactNormal2.mVec128,\ bodyB.internalGetInvMass().mVec128);}
\DoxyCodeLine{00227\ \ \ \ \ \_\_m128\ impulseMagnitude\ =\ deltaImpulse;}
\DoxyCodeLine{00228\ \ \ \ \ bodyA.internalGetDeltaLinearVelocity().mVec128\ =\ \_mm\_add\_ps(bodyA.internalGetDeltaLinearVelocity().mVec128,\ \_mm\_mul\_ps(linearComponentA,\ impulseMagnitude));}
\DoxyCodeLine{00229\ \ \ \ \ bodyA.internalGetDeltaAngularVelocity().mVec128\ =\ \_mm\_add\_ps(bodyA.internalGetDeltaAngularVelocity().mVec128,\ \_mm\_mul\_ps(c.m\_angularComponentA.mVec128,\ impulseMagnitude));}
\DoxyCodeLine{00230\ \ \ \ \ bodyB.internalGetDeltaLinearVelocity().mVec128\ =\ \_mm\_add\_ps(bodyB.internalGetDeltaLinearVelocity().mVec128,\ \_mm\_mul\_ps(linearComponentB,\ impulseMagnitude));}
\DoxyCodeLine{00231\ \ \ \ \ bodyB.internalGetDeltaAngularVelocity().mVec128\ =\ \_mm\_add\_ps(bodyB.internalGetDeltaAngularVelocity().mVec128,\ \_mm\_mul\_ps(c.m\_angularComponentB.mVec128,\ impulseMagnitude));}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImpulse.m\_floats[0]\ /\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00233\ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \textcolor{comment}{//\ Enhanced\ version\ of\ gResolveSingleConstraintRowGeneric\_sse2\ with\ SSE4.1\ and\ FMA3}}
\DoxyCodeLine{00236\ \textcolor{keyword}{static}\ btScalar\ gResolveSingleConstraintRowLowerLimit\_sse4\_1\_fma3(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00237\ \{}
\DoxyCodeLine{00238\ \textcolor{preprocessor}{\#ifdef\ BT\_ALLOW\_SSE4}}
\DoxyCodeLine{00239\ \ \ \ \ \_\_m128\ tmp\ =\ \_mm\_set\_ps1(c.m\_jacDiagABInv);}
\DoxyCodeLine{00240\ \ \ \ \ \_\_m128\ deltaImpulse\ =\ \_mm\_set\_ps1(c.m\_rhs\ -\/\ btScalar(c.m\_appliedImpulse)\ *\ c.m\_cfm);}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ lowerLimit\ =\ \_mm\_set\_ps1(c.m\_lowerLimit);}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ deltaVel1Dotn\ =\ \_mm\_add\_ps(DOT\_PRODUCT(c.m\_contactNormal1.mVec128,\ bodyA.internalGetDeltaLinearVelocity().mVec128),\ DOT\_PRODUCT(c.m\_relpos1CrossNormal.mVec128,\ bodyA.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ deltaVel2Dotn\ =\ \_mm\_add\_ps(DOT\_PRODUCT(c.m\_contactNormal2.mVec128,\ bodyB.internalGetDeltaLinearVelocity().mVec128),\ DOT\_PRODUCT(c.m\_relpos2CrossNormal.mVec128,\ bodyB.internalGetDeltaAngularVelocity().mVec128));}
\DoxyCodeLine{00244\ \ \ \ \ deltaImpulse\ =\ FMNADD(deltaVel1Dotn,\ tmp,\ deltaImpulse);}
\DoxyCodeLine{00245\ \ \ \ \ deltaImpulse\ =\ FMNADD(deltaVel2Dotn,\ tmp,\ deltaImpulse);}
\DoxyCodeLine{00246\ \ \ \ \ tmp\ =\ \_mm\_add\_ps(c.m\_appliedImpulse,\ deltaImpulse);}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m128\ mask\ =\ \_mm\_cmpgt\_ps(tmp,\ lowerLimit);}
\DoxyCodeLine{00248\ \ \ \ \ deltaImpulse\ =\ \_mm\_blendv\_ps(\_mm\_sub\_ps(lowerLimit,\ c.m\_appliedImpulse),\ deltaImpulse,\ mask);}
\DoxyCodeLine{00249\ \ \ \ \ c.m\_appliedImpulse\ =\ \_mm\_blendv\_ps(lowerLimit,\ tmp,\ mask);}
\DoxyCodeLine{00250\ \ \ \ \ bodyA.internalGetDeltaLinearVelocity().mVec128\ =\ FMADD(\_mm\_mul\_ps(c.m\_contactNormal1.mVec128,\ bodyA.internalGetInvMass().mVec128),\ deltaImpulse,\ bodyA.internalGetDeltaLinearVelocity().mVec128);}
\DoxyCodeLine{00251\ \ \ \ \ bodyA.internalGetDeltaAngularVelocity().mVec128\ =\ FMADD(c.m\_angularComponentA.mVec128,\ deltaImpulse,\ bodyA.internalGetDeltaAngularVelocity().mVec128);}
\DoxyCodeLine{00252\ \ \ \ \ bodyB.internalGetDeltaLinearVelocity().mVec128\ =\ FMADD(\_mm\_mul\_ps(c.m\_contactNormal2.mVec128,\ bodyB.internalGetInvMass().mVec128),\ deltaImpulse,\ bodyB.internalGetDeltaLinearVelocity().mVec128);}
\DoxyCodeLine{00253\ \ \ \ \ bodyB.internalGetDeltaAngularVelocity().mVec128\ =\ FMADD(c.m\_angularComponentB.mVec128,\ deltaImpulse,\ bodyB.internalGetDeltaAngularVelocity().mVec128);}
\DoxyCodeLine{00254\ \ \ \ \ btSimdScalar\ deltaImp\ =\ deltaImpulse;}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImp.m\_floats[0]\ *\ (1.\ /\ c.m\_jacDiagABInv);}
\DoxyCodeLine{00256\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowLowerLimit\_sse2(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00258\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//BT\_ALLOW\_SSE4}}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//USE\_SIMD}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ btScalar\ btSequentialImpulseConstraintSolver::resolveSingleConstraintRowGenericSIMD(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00264\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_resolveSingleConstraintRowGeneric(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00266\ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \textcolor{comment}{//\ Project\ Gauss\ Seidel\ or\ the\ equivalent\ Sequential\ Impulse}}
\DoxyCodeLine{00269\ btScalar\ btSequentialImpulseConstraintSolver::resolveSingleConstraintRowGeneric(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00270\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_resolveSingleConstraintRowGeneric(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00272\ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ btScalar\ btSequentialImpulseConstraintSolver::resolveSingleConstraintRowLowerLimitSIMD(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00275\ \{}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_resolveSingleConstraintRowLowerLimit(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00277\ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ btScalar\ btSequentialImpulseConstraintSolver::resolveSingleConstraintRowLowerLimit(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00280\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_resolveSingleConstraintRowLowerLimit(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \textcolor{keyword}{static}\ btScalar\ gResolveSplitPenetrationImpulse\_scalar\_reference(}
\DoxyCodeLine{00285\ \ \ \ \ btSolverBody\&\ bodyA,}
\DoxyCodeLine{00286\ \ \ \ \ btSolverBody\&\ bodyB,}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00288\ \{}
\DoxyCodeLine{00289\ \ \ \ \ btScalar\ deltaImpulse\ =\ 0.f;}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{if}\ (c.m\_rhsPenetration)}
\DoxyCodeLine{00292\ \ \ \ \ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ gNumSplitImpulseRecoveries++;}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ deltaImpulse\ =\ c.m\_rhsPenetration\ -\/\ btScalar(c.m\_appliedPushImpulse)\ *\ c.m\_cfm;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ deltaVel1Dotn\ =\ c.m\_contactNormal1.dot(bodyA.internalGetPushVelocity())\ +\ c.m\_relpos1CrossNormal.dot(bodyA.internalGetTurnVelocity());}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ deltaVel2Dotn\ =\ c.m\_contactNormal2.dot(bodyB.internalGetPushVelocity())\ +\ c.m\_relpos2CrossNormal.dot(bodyB.internalGetTurnVelocity());}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ deltaImpulse\ -\/=\ deltaVel1Dotn\ *\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ deltaImpulse\ -\/=\ deltaVel2Dotn\ *\ c.m\_jacDiagABInv;}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btScalar\ sum\ =\ btScalar(c.m\_appliedPushImpulse)\ +\ deltaImpulse;}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sum\ <\ c.m\_lowerLimit)}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ deltaImpulse\ =\ c.m\_lowerLimit\ -\/\ c.m\_appliedPushImpulse;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ c.m\_appliedPushImpulse\ =\ c.m\_lowerLimit;}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ c.m\_appliedPushImpulse\ =\ sum;}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ bodyA.internalApplyPushImpulse(c.m\_contactNormal1\ *\ bodyA.internalGetInvMass(),\ c.m\_angularComponentA,\ deltaImpulse);}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ bodyB.internalApplyPushImpulse(c.m\_contactNormal2\ *\ bodyB.internalGetInvMass(),\ c.m\_angularComponentB,\ deltaImpulse);}
\DoxyCodeLine{00312\ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImpulse\ *\ (1.\ /\ c.m\_jacDiagABInv);}
\DoxyCodeLine{00314\ \}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \textcolor{keyword}{static}\ btScalar\ gResolveSplitPenetrationImpulse\_sse2(btSolverBody\&\ bodyA,\ btSolverBody\&\ bodyB,\ \textcolor{keyword}{const}\ btSolverConstraint\&\ c)}
\DoxyCodeLine{00317\ \{}
\DoxyCodeLine{00318\ \textcolor{preprocessor}{\#ifdef\ USE\_SIMD}}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{keywordflow}{if}\ (!c.m\_rhsPenetration)}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.f;}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ gNumSplitImpulseRecoveries++;}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \_\_m128\ cpAppliedImp\ =\ \_mm\_set1\_ps(c.m\_appliedPushImpulse);}
\DoxyCodeLine{00325\ \ \ \ \ \_\_m128\ lowerLimit1\ =\ \_mm\_set1\_ps(c.m\_lowerLimit);}
\DoxyCodeLine{00326\ \ \ \ \ \_\_m128\ upperLimit1\ =\ \_mm\_set1\_ps(c.m\_upperLimit);}
\DoxyCodeLine{00327\ \ \ \ \ \_\_m128\ deltaImpulse\ =\ \_mm\_sub\_ps(\_mm\_set1\_ps(c.m\_rhsPenetration),\ \_mm\_mul\_ps(\_mm\_set1\_ps(c.m\_appliedPushImpulse),\ \_mm\_set1\_ps(c.m\_cfm)));}
\DoxyCodeLine{00328\ \ \ \ \ \_\_m128\ deltaVel1Dotn\ =\ \_mm\_add\_ps(btSimdDot3(c.m\_contactNormal1.mVec128,\ bodyA.internalGetPushVelocity().mVec128),\ btSimdDot3(c.m\_relpos1CrossNormal.mVec128,\ bodyA.internalGetTurnVelocity().mVec128));}
\DoxyCodeLine{00329\ \ \ \ \ \_\_m128\ deltaVel2Dotn\ =\ \_mm\_add\_ps(btSimdDot3(c.m\_contactNormal2.mVec128,\ bodyB.internalGetPushVelocity().mVec128),\ btSimdDot3(c.m\_relpos2CrossNormal.mVec128,\ bodyB.internalGetTurnVelocity().mVec128));}
\DoxyCodeLine{00330\ \ \ \ \ deltaImpulse\ =\ \_mm\_sub\_ps(deltaImpulse,\ \_mm\_mul\_ps(deltaVel1Dotn,\ \_mm\_set1\_ps(c.m\_jacDiagABInv)));}
\DoxyCodeLine{00331\ \ \ \ \ deltaImpulse\ =\ \_mm\_sub\_ps(deltaImpulse,\ \_mm\_mul\_ps(deltaVel2Dotn,\ \_mm\_set1\_ps(c.m\_jacDiagABInv)));}
\DoxyCodeLine{00332\ \ \ \ \ btSimdScalar\ sum\ =\ \_mm\_add\_ps(cpAppliedImp,\ deltaImpulse);}
\DoxyCodeLine{00333\ \ \ \ \ btSimdScalar\ resultLowerLess,\ resultUpperLess;}
\DoxyCodeLine{00334\ \ \ \ \ resultLowerLess\ =\ \_mm\_cmplt\_ps(sum,\ lowerLimit1);}
\DoxyCodeLine{00335\ \ \ \ \ resultUpperLess\ =\ \_mm\_cmplt\_ps(sum,\ upperLimit1);}
\DoxyCodeLine{00336\ \ \ \ \ \_\_m128\ lowMinApplied\ =\ \_mm\_sub\_ps(lowerLimit1,\ cpAppliedImp);}
\DoxyCodeLine{00337\ \ \ \ \ deltaImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultLowerLess,\ lowMinApplied),\ \_mm\_andnot\_ps(resultLowerLess,\ deltaImpulse));}
\DoxyCodeLine{00338\ \ \ \ \ c.m\_appliedPushImpulse\ =\ \_mm\_or\_ps(\_mm\_and\_ps(resultLowerLess,\ lowerLimit1),\ \_mm\_andnot\_ps(resultLowerLess,\ sum));}
\DoxyCodeLine{00339\ \ \ \ \ \_\_m128\ linearComponentA\ =\ \_mm\_mul\_ps(c.m\_contactNormal1.mVec128,\ bodyA.internalGetInvMass().mVec128);}
\DoxyCodeLine{00340\ \ \ \ \ \_\_m128\ linearComponentB\ =\ \_mm\_mul\_ps(c.m\_contactNormal2.mVec128,\ bodyB.internalGetInvMass().mVec128);}
\DoxyCodeLine{00341\ \ \ \ \ \_\_m128\ impulseMagnitude\ =\ deltaImpulse;}
\DoxyCodeLine{00342\ \ \ \ \ bodyA.internalGetPushVelocity().mVec128\ =\ \_mm\_add\_ps(bodyA.internalGetPushVelocity().mVec128,\ \_mm\_mul\_ps(linearComponentA,\ impulseMagnitude));}
\DoxyCodeLine{00343\ \ \ \ \ bodyA.internalGetTurnVelocity().mVec128\ =\ \_mm\_add\_ps(bodyA.internalGetTurnVelocity().mVec128,\ \_mm\_mul\_ps(c.m\_angularComponentA.mVec128,\ impulseMagnitude));}
\DoxyCodeLine{00344\ \ \ \ \ bodyB.internalGetPushVelocity().mVec128\ =\ \_mm\_add\_ps(bodyB.internalGetPushVelocity().mVec128,\ \_mm\_mul\_ps(linearComponentB,\ impulseMagnitude));}
\DoxyCodeLine{00345\ \ \ \ \ bodyB.internalGetTurnVelocity().mVec128\ =\ \_mm\_add\_ps(bodyB.internalGetTurnVelocity().mVec128,\ \_mm\_mul\_ps(c.m\_angularComponentB.mVec128,\ impulseMagnitude));}
\DoxyCodeLine{00346\ \ \ \ \ btSimdScalar\ deltaImp\ =\ deltaImpulse;}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordflow}{return}\ deltaImp.m\_floats[0]\ *\ (1.\ /\ c.m\_jacDiagABInv);}
\DoxyCodeLine{00348\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSplitPenetrationImpulse\_scalar\_reference(bodyA,\ bodyB,\ c);}
\DoxyCodeLine{00350\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ btSequentialImpulseConstraintSolver::btSequentialImpulseConstraintSolver()}
\DoxyCodeLine{00354\ \{}
\DoxyCodeLine{00355\ \ \ \ \ m\_btSeed2\ =\ 0;}
\DoxyCodeLine{00356\ \ \ \ \ m\_cachedSolverMode\ =\ 0;}
\DoxyCodeLine{00357\ \ \ \ \ setupSolverFunctions(\textcolor{keyword}{false});}
\DoxyCodeLine{00358\ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::setupSolverFunctions(\textcolor{keywordtype}{bool}\ useSimd)}
\DoxyCodeLine{00361\ \{}
\DoxyCodeLine{00362\ \ \ \ \ m\_resolveSingleConstraintRowGeneric\ =\ gResolveSingleConstraintRowGeneric\_scalar\_reference;}
\DoxyCodeLine{00363\ \ \ \ \ m\_resolveSingleConstraintRowLowerLimit\ =\ gResolveSingleConstraintRowLowerLimit\_scalar\_reference;}
\DoxyCodeLine{00364\ \ \ \ \ m\_resolveSplitPenetrationImpulse\ =\ gResolveSplitPenetrationImpulse\_scalar\_reference;}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keywordflow}{if}\ (useSimd)}
\DoxyCodeLine{00367\ \ \ \ \ \{}
\DoxyCodeLine{00368\ \textcolor{preprocessor}{\#ifdef\ USE\_SIMD}}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ m\_resolveSingleConstraintRowGeneric\ =\ gResolveSingleConstraintRowGeneric\_sse2;}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ m\_resolveSingleConstraintRowLowerLimit\ =\ gResolveSingleConstraintRowLowerLimit\_sse2;}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ m\_resolveSplitPenetrationImpulse\ =\ gResolveSplitPenetrationImpulse\_sse2;}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \textcolor{preprocessor}{\#ifdef\ BT\_ALLOW\_SSE4}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cpuFeatures\ =\ btCpuFeatureUtility::getCpuFeatures();}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((cpuFeatures\ \&\ btCpuFeatureUtility::CPU\_FEATURE\_FMA3)\ \&\&\ (cpuFeatures\ \&\ btCpuFeatureUtility::CPU\_FEATURE\_SSE4\_1))}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ m\_resolveSingleConstraintRowGeneric\ =\ gResolveSingleConstraintRowGeneric\_sse4\_1\_fma3;}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ m\_resolveSingleConstraintRowLowerLimit\ =\ gResolveSingleConstraintRowLowerLimit\_sse4\_1\_fma3;}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00380\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//BT\_ALLOW\_SSE4}}
\DoxyCodeLine{00381\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//USE\_SIMD}}
\DoxyCodeLine{00382\ \ \ \ \ \}}
\DoxyCodeLine{00383\ \}}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ btSequentialImpulseConstraintSolver::\string~btSequentialImpulseConstraintSolver()}
\DoxyCodeLine{00386\ \{}
\DoxyCodeLine{00387\ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ btSingleConstraintRowSolver\ btSequentialImpulseConstraintSolver::getScalarConstraintRowSolverGeneric()}
\DoxyCodeLine{00390\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowGeneric\_scalar\_reference;}
\DoxyCodeLine{00392\ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ btSingleConstraintRowSolver\ btSequentialImpulseConstraintSolver::getScalarConstraintRowSolverLowerLimit()}
\DoxyCodeLine{00395\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowLowerLimit\_scalar\_reference;}
\DoxyCodeLine{00397\ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \textcolor{preprocessor}{\#ifdef\ USE\_SIMD}}
\DoxyCodeLine{00400\ btSingleConstraintRowSolver\ btSequentialImpulseConstraintSolver::getSSE2ConstraintRowSolverGeneric()}
\DoxyCodeLine{00401\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowGeneric\_sse2;}
\DoxyCodeLine{00403\ \}}
\DoxyCodeLine{00404\ btSingleConstraintRowSolver\ btSequentialImpulseConstraintSolver::getSSE2ConstraintRowSolverLowerLimit()}
\DoxyCodeLine{00405\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowLowerLimit\_sse2;}
\DoxyCodeLine{00407\ \}}
\DoxyCodeLine{00408\ \textcolor{preprocessor}{\#ifdef\ BT\_ALLOW\_SSE4}}
\DoxyCodeLine{00409\ btSingleConstraintRowSolver\ btSequentialImpulseConstraintSolver::getSSE4\_1ConstraintRowSolverGeneric()}
\DoxyCodeLine{00410\ \{}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowGeneric\_sse4\_1\_fma3;}
\DoxyCodeLine{00412\ \}}
\DoxyCodeLine{00413\ btSingleConstraintRowSolver\ btSequentialImpulseConstraintSolver::getSSE4\_1ConstraintRowSolverLowerLimit()}
\DoxyCodeLine{00414\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordflow}{return}\ gResolveSingleConstraintRowLowerLimit\_sse4\_1\_fma3;}
\DoxyCodeLine{00416\ \}}
\DoxyCodeLine{00417\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//BT\_ALLOW\_SSE4}}
\DoxyCodeLine{00418\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//USE\_SIMD}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ btSequentialImpulseConstraintSolver::btRand2()}
\DoxyCodeLine{00421\ \{}
\DoxyCodeLine{00422\ \ \ \ \ m\_btSeed2\ =\ (1664525L\ *\ m\_btSeed2\ +\ 1013904223L)\ \&\ 0xffffffff;}
\DoxyCodeLine{00423\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_btSeed2;}
\DoxyCodeLine{00424\ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \textcolor{comment}{//See\ ODE:\ adam's\ all-\/int\ straightforward(?)\ dRandInt\ (0..n-\/1)}}
\DoxyCodeLine{00427\ \textcolor{keywordtype}{int}\ btSequentialImpulseConstraintSolver::btRandInt2(\textcolor{keywordtype}{int}\ n)}
\DoxyCodeLine{00428\ \{}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{comment}{//\ seems\ good;\ xor-\/fold\ and\ modulus}}
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ un\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(n);}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ r\ =\ btRand2();}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{comment}{//\ note:\ probably\ more\ aggressive\ than\ it\ needs\ to\ be\ -\/-\/\ might\ be}}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ able\ to\ get\ away\ without\ one\ or\ two\ of\ the\ innermost\ branches.}}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordflow}{if}\ (un\ <=\ 0x00010000UL)}
\DoxyCodeLine{00436\ \ \ \ \ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ r\ \string^=\ (r\ >>\ 16);}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (un\ <=\ 0x00000100UL)}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ r\ \string^=\ (r\ >>\ 8);}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (un\ <=\ 0x00000010UL)}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r\ \string^=\ (r\ >>\ 4);}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (un\ <=\ 0x00000004UL)}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r\ \string^=\ (r\ >>\ 2);}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (un\ <=\ 0x00000002UL)}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r\ \string^=\ (r\ >>\ 1);}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00454\ \ \ \ \ \}}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})(r\ \%\ un);}
\DoxyCodeLine{00457\ \}}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::initSolverBody(btSolverBody*\ solverBody,\ btCollisionObject*\ collisionObject,\ btScalar\ timeStep)}
\DoxyCodeLine{00460\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ rb\ =\ collisionObject\ ?\ \mbox{\hyperlink{classbt_rigid_body_ae4867a6bafb413e3a2e18dd1de125042}{btRigidBody::upcast}}(collisionObject)\ :\ 0;}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ solverBody-\/>internalGetDeltaLinearVelocity().setValue(0.f,\ 0.f,\ 0.f);}
\DoxyCodeLine{00464\ \ \ \ \ solverBody-\/>internalGetDeltaAngularVelocity().setValue(0.f,\ 0.f,\ 0.f);}
\DoxyCodeLine{00465\ \ \ \ \ solverBody-\/>internalGetPushVelocity().setValue(0.f,\ 0.f,\ 0.f);}
\DoxyCodeLine{00466\ \ \ \ \ solverBody-\/>internalGetTurnVelocity().setValue(0.f,\ 0.f,\ 0.f);}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \ \ \textcolor{keywordflow}{if}\ (rb)}
\DoxyCodeLine{00469\ \ \ \ \ \{}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ solverBody-\/>m\_worldTransform\ =\ rb-\/>getWorldTransform();}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ solverBody-\/>internalSetInvMass(btVector3(rb-\/>getInvMass(),\ rb-\/>getInvMass(),\ rb-\/>getInvMass())\ *\ rb-\/>getLinearFactor());}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ solverBody-\/>m\_originalBody\ =\ rb;}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ solverBody-\/>m\_angularFactor\ =\ rb-\/>getAngularFactor();}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ solverBody-\/>m\_linearFactor\ =\ rb-\/>getLinearFactor();}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ solverBody-\/>m\_linearVelocity\ =\ rb-\/>getLinearVelocity();}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ solverBody-\/>m\_angularVelocity\ =\ rb-\/>getAngularVelocity();}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ solverBody-\/>m\_externalForceImpulse\ =\ rb-\/>getTotalForce()\ *\ rb-\/>getInvMass()\ *\ timeStep;}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ solverBody-\/>m\_externalTorqueImpulse\ =\ rb-\/>getTotalTorque()\ *\ rb-\/>getInvInertiaTensorWorld()\ *\ timeStep;}
\DoxyCodeLine{00479\ \ \ \ \ \}}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ solverBody-\/>m\_worldTransform.setIdentity();}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ solverBody-\/>internalSetInvMass(btVector3(0,\ 0,\ 0));}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ solverBody-\/>m\_originalBody\ =\ 0;}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ solverBody-\/>m\_angularFactor.setValue(1,\ 1,\ 1);}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ solverBody-\/>m\_linearFactor.setValue(1,\ 1,\ 1);}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ solverBody-\/>m\_linearVelocity.setValue(0,\ 0,\ 0);}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ solverBody-\/>m\_angularVelocity.setValue(0,\ 0,\ 0);}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ solverBody-\/>m\_externalForceImpulse.setValue(0,\ 0,\ 0);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ solverBody-\/>m\_externalTorqueImpulse.setValue(0,\ 0,\ 0);}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ btScalar\ btSequentialImpulseConstraintSolver::restitutionCurve(btScalar\ rel\_vel,\ btScalar\ restitution,\ btScalar\ velocityThreshold)}
\DoxyCodeLine{00495\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{comment}{//printf("{}rel\_vel\ =\%f\(\backslash\)n"{},\ rel\_vel);}}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{if}\ (btFabs(rel\_vel)\ <\ velocityThreshold)}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.;}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \ \ btScalar\ rest\ =\ restitution\ *\ -\/rel\_vel;}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordflow}{return}\ rest;}
\DoxyCodeLine{00502\ \}}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::applyAnisotropicFriction(btCollisionObject*\ colObj,\ btVector3\&\ frictionDirection,\ \textcolor{keywordtype}{int}\ frictionMode)}
\DoxyCodeLine{00505\ \{}
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordflow}{if}\ (colObj\ \&\&\ colObj-\/>hasAnisotropicFriction(frictionMode))}
\DoxyCodeLine{00507\ \ \ \ \ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ transform\ to\ local\ coordinates}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ btVector3\ loc\_lateral\ =\ frictionDirection\ *\ colObj-\/>getWorldTransform().getBasis();}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ friction\_scaling\ =\ colObj-\/>getAnisotropicFriction();}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \textcolor{comment}{//apply\ anisotropic\ friction}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ loc\_lateral\ *=\ friction\_scaling;}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ...\ and\ transform\ it\ back\ to\ global\ coordinates}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ frictionDirection\ =\ colObj-\/>getWorldTransform().getBasis()\ *\ loc\_lateral;}
\DoxyCodeLine{00515\ \ \ \ \ \}}
\DoxyCodeLine{00516\ \}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::setupFrictionConstraint(btSolverConstraint\&\ solverConstraint,\ \textcolor{keyword}{const}\ btVector3\&\ normalAxis,\ \textcolor{keywordtype}{int}\ solverBodyIdA,\ \textcolor{keywordtype}{int}\ solverBodyIdB,\ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos1,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos2,\ btCollisionObject*\ colObj0,\ btCollisionObject*\ colObj1,\ btScalar\ relaxation,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ btScalar\ desiredVelocity,\ btScalar\ cfmSlip)}
\DoxyCodeLine{00519\ \{}
\DoxyCodeLine{00520\ \ \ \ \ btSolverBody\&\ solverBodyA\ =\ m\_tmpSolverBodyPool[solverBodyIdA];}
\DoxyCodeLine{00521\ \ \ \ \ btSolverBody\&\ solverBodyB\ =\ m\_tmpSolverBodyPool[solverBodyIdB];}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ body0\ =\ m\_tmpSolverBodyPool[solverBodyIdA].m\_originalBody;}
\DoxyCodeLine{00524\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ bodyA\ =\ m\_tmpSolverBodyPool[solverBodyIdB].m\_originalBody;}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \ \ solverConstraint.m\_solverBodyIdA\ =\ solverBodyIdA;}
\DoxyCodeLine{00527\ \ \ \ \ solverConstraint.m\_solverBodyIdB\ =\ solverBodyIdB;}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ solverConstraint.m\_friction\ =\ cp.m\_combinedFriction;}
\DoxyCodeLine{00530\ \ \ \ \ solverConstraint.m\_originalContactPoint\ =\ 0;}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ solverConstraint.m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{00533\ \ \ \ \ solverConstraint.m\_appliedPushImpulse\ =\ 0.f;}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{keywordflow}{if}\ (body0)}
\DoxyCodeLine{00536\ \ \ \ \ \{}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal1\ =\ normalAxis;}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ btVector3\ ftorqueAxis1\ =\ rel\_pos1.cross(solverConstraint.m\_contactNormal1);}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos1CrossNormal\ =\ ftorqueAxis1;}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentA\ =\ body0-\/>getInvInertiaTensorWorld()\ *\ ftorqueAxis1\ *\ body0-\/>getAngularFactor();}
\DoxyCodeLine{00541\ \ \ \ \ \}}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00543\ \ \ \ \ \{}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal1.setZero();}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos1CrossNormal.setZero();}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentA.setZero();}
\DoxyCodeLine{00547\ \ \ \ \ \}}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ \ \ \textcolor{keywordflow}{if}\ (bodyA)}
\DoxyCodeLine{00550\ \ \ \ \ \{}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal2\ =\ -\/normalAxis;}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ btVector3\ ftorqueAxis1\ =\ rel\_pos2.cross(solverConstraint.m\_contactNormal2);}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos2CrossNormal\ =\ ftorqueAxis1;}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentB\ =\ bodyA-\/>getInvInertiaTensorWorld()\ *\ ftorqueAxis1\ *\ bodyA-\/>getAngularFactor();}
\DoxyCodeLine{00555\ \ \ \ \ \}}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00557\ \ \ \ \ \{}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal2.setZero();}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos2CrossNormal.setZero();}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentB.setZero();}
\DoxyCodeLine{00561\ \ \ \ \ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ btVector3\ vec;}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ btScalar\ denom0\ =\ 0.f;}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ btScalar\ denom1\ =\ 0.f;}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (body0)}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ vec\ =\ (solverConstraint.m\_angularComponentA).cross(rel\_pos1);}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ denom0\ =\ body0-\/>getInvMass()\ +\ normalAxis.dot(vec);}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bodyA)}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ vec\ =\ (-\/solverConstraint.m\_angularComponentB).cross(rel\_pos2);}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ denom1\ =\ bodyA-\/>getInvMass()\ +\ normalAxis.dot(vec);}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ btScalar\ denom\ =\ relaxation\ /\ (denom0\ +\ denom1);}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ solverConstraint.m\_jacDiagABInv\ =\ denom;}
\DoxyCodeLine{00579\ \ \ \ \ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \ \ \ \ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ btScalar\ rel\_vel;}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ btScalar\ vel1Dotn\ =\ solverConstraint.m\_contactNormal1.dot(body0\ ?\ solverBodyA.m\_linearVelocity\ +\ solverBodyA.m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0))\ +\ solverConstraint.m\_relpos1CrossNormal.dot(body0\ ?\ solverBodyA.m\_angularVelocity\ :\ btVector3(0,\ 0,\ 0));}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ btScalar\ vel2Dotn\ =\ solverConstraint.m\_contactNormal2.dot(bodyA\ ?\ solverBodyB.m\_linearVelocity\ +\ solverBodyB.m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0))\ +\ solverConstraint.m\_relpos2CrossNormal.dot(bodyA\ ?\ solverBodyB.m\_angularVelocity\ :\ btVector3(0,\ 0,\ 0));}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ rel\_vel\ =\ vel1Dotn\ +\ vel2Dotn;}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ btScalar\ positionalError\ =\ 0.f;}}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ btScalar\ velocityError\ =\ desiredVelocity\ -\/\ rel\_vel;}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ btScalar\ velocityImpulse\ =\ velocityError\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ btScalar\ penetrationImpulse\ =\ btScalar(0);}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_FRICTION\_ANCHOR)}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ distance\ =\ (cp.getPositionWorldOnA()\ -\/\ cp.getPositionWorldOnB()).dot(normalAxis);}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ positionalError\ =\ -\/distance\ *\ infoGlobal.m\_frictionERP\ /\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ penetrationImpulse\ =\ positionalError\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ solverConstraint.m\_rhs\ =\ penetrationImpulse\ +\ velocityImpulse;}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ solverConstraint.m\_rhsPenetration\ =\ 0.f;}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ solverConstraint.m\_cfm\ =\ cfmSlip;}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ solverConstraint.m\_lowerLimit\ =\ -\/solverConstraint.m\_friction;}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ solverConstraint.m\_upperLimit\ =\ solverConstraint.m\_friction;}
\DoxyCodeLine{00607\ \ \ \ \ \}}
\DoxyCodeLine{00608\ \}}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ btSolverConstraint\&\ btSequentialImpulseConstraintSolver::addFrictionConstraint(\textcolor{keyword}{const}\ btVector3\&\ normalAxis,\ \textcolor{keywordtype}{int}\ solverBodyIdA,\ \textcolor{keywordtype}{int}\ solverBodyIdB,\ \textcolor{keywordtype}{int}\ frictionIndex,\ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos1,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos2,\ btCollisionObject*\ colObj0,\ btCollisionObject*\ colObj1,\ btScalar\ relaxation,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ btScalar\ desiredVelocity,\ btScalar\ cfmSlip)}
\DoxyCodeLine{00611\ \{}
\DoxyCodeLine{00612\ \ \ \ \ btSolverConstraint\&\ solverConstraint\ =\ m\_tmpSolverContactFrictionConstraintPool.expandNonInitializing();}
\DoxyCodeLine{00613\ \ \ \ \ solverConstraint.m\_frictionIndex\ =\ frictionIndex;}
\DoxyCodeLine{00614\ \ \ \ \ setupFrictionConstraint(solverConstraint,\ normalAxis,\ solverBodyIdA,\ solverBodyIdB,\ cp,\ rel\_pos1,\ rel\_pos2,}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ colObj0,\ colObj1,\ relaxation,\ infoGlobal,\ desiredVelocity,\ cfmSlip);}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keywordflow}{return}\ solverConstraint;}
\DoxyCodeLine{00617\ \}}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::setupTorsionalFrictionConstraint(btSolverConstraint\&\ solverConstraint,\ \textcolor{keyword}{const}\ btVector3\&\ normalAxis1,\ \textcolor{keywordtype}{int}\ solverBodyIdA,\ \textcolor{keywordtype}{int}\ solverBodyIdB,}
\DoxyCodeLine{00620\ \ \ \ \ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp,\ btScalar\ combinedTorsionalFriction,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos1,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos2,}
\DoxyCodeLine{00621\ \ \ \ \ btCollisionObject*\ colObj0,\ btCollisionObject*\ colObj1,\ btScalar\ relaxation,}
\DoxyCodeLine{00622\ \ \ \ \ btScalar\ desiredVelocity,\ btScalar\ cfmSlip)}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00624\ \{}
\DoxyCodeLine{00625\ \ \ \ \ btVector3\ normalAxis(0,\ 0,\ 0);}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \ \ solverConstraint.m\_contactNormal1\ =\ normalAxis;}
\DoxyCodeLine{00628\ \ \ \ \ solverConstraint.m\_contactNormal2\ =\ -\/normalAxis;}
\DoxyCodeLine{00629\ \ \ \ \ btSolverBody\&\ solverBodyA\ =\ m\_tmpSolverBodyPool[solverBodyIdA];}
\DoxyCodeLine{00630\ \ \ \ \ btSolverBody\&\ solverBodyB\ =\ m\_tmpSolverBodyPool[solverBodyIdB];}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ body0\ =\ m\_tmpSolverBodyPool[solverBodyIdA].m\_originalBody;}
\DoxyCodeLine{00633\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ bodyA\ =\ m\_tmpSolverBodyPool[solverBodyIdB].m\_originalBody;}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \ \ solverConstraint.m\_solverBodyIdA\ =\ solverBodyIdA;}
\DoxyCodeLine{00636\ \ \ \ \ solverConstraint.m\_solverBodyIdB\ =\ solverBodyIdB;}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \ \ solverConstraint.m\_friction\ =\ combinedTorsionalFriction;}
\DoxyCodeLine{00639\ \ \ \ \ solverConstraint.m\_originalContactPoint\ =\ 0;}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ solverConstraint.m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{00642\ \ \ \ \ solverConstraint.m\_appliedPushImpulse\ =\ 0.f;}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ \{}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ btVector3\ ftorqueAxis1\ =\ -\/normalAxis1;}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos1CrossNormal\ =\ ftorqueAxis1;}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentA\ =\ body0\ ?\ body0-\/>getInvInertiaTensorWorld()\ *\ ftorqueAxis1\ *\ body0-\/>getAngularFactor()\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00648\ \ \ \ \ \}}
\DoxyCodeLine{00649\ \ \ \ \ \{}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ btVector3\ ftorqueAxis1\ =\ normalAxis1;}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos2CrossNormal\ =\ ftorqueAxis1;}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentB\ =\ bodyA\ ?\ bodyA-\/>getInvInertiaTensorWorld()\ *\ ftorqueAxis1\ *\ bodyA-\/>getAngularFactor()\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00653\ \ \ \ \ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \ \ \{}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ btVector3\ iMJaA\ =\ body0\ ?\ body0-\/>getInvInertiaTensorWorld()\ *\ solverConstraint.m\_relpos1CrossNormal\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ btVector3\ iMJaB\ =\ bodyA\ ?\ bodyA-\/>getInvInertiaTensorWorld()\ *\ solverConstraint.m\_relpos2CrossNormal\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ btScalar\ sum\ =\ 0;}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ sum\ +=\ iMJaA.dot(solverConstraint.m\_relpos1CrossNormal);}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ sum\ +=\ iMJaB.dot(solverConstraint.m\_relpos2CrossNormal);}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ solverConstraint.m\_jacDiagABInv\ =\ btScalar(1.)\ /\ sum;}
\DoxyCodeLine{00662\ \ \ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \ \ \{}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ btScalar\ rel\_vel;}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ btScalar\ vel1Dotn\ =\ solverConstraint.m\_contactNormal1.dot(body0\ ?\ solverBodyA.m\_linearVelocity\ +\ solverBodyA.m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0))\ +\ solverConstraint.m\_relpos1CrossNormal.dot(body0\ ?\ solverBodyA.m\_angularVelocity\ :\ btVector3(0,\ 0,\ 0));}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ btScalar\ vel2Dotn\ =\ solverConstraint.m\_contactNormal2.dot(bodyA\ ?\ solverBodyB.m\_linearVelocity\ +\ solverBodyB.m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0))\ +\ solverConstraint.m\_relpos2CrossNormal.dot(bodyA\ ?\ solverBodyB.m\_angularVelocity\ :\ btVector3(0,\ 0,\ 0));}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ rel\_vel\ =\ vel1Dotn\ +\ vel2Dotn;}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ btScalar\ positionalError\ =\ 0.f;}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ btSimdScalar\ velocityError\ =\ desiredVelocity\ -\/\ rel\_vel;}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ btSimdScalar\ velocityImpulse\ =\ velocityError\ *\ btSimdScalar(solverConstraint.m\_jacDiagABInv);}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ solverConstraint.m\_rhs\ =\ velocityImpulse;}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ solverConstraint.m\_cfm\ =\ cfmSlip;}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ solverConstraint.m\_lowerLimit\ =\ -\/solverConstraint.m\_friction;}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ solverConstraint.m\_upperLimit\ =\ solverConstraint.m\_friction;}
\DoxyCodeLine{00679\ \ \ \ \ \}}
\DoxyCodeLine{00680\ \}}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ btSolverConstraint\&\ btSequentialImpulseConstraintSolver::addTorsionalFrictionConstraint(\textcolor{keyword}{const}\ btVector3\&\ normalAxis,\ \textcolor{keywordtype}{int}\ solverBodyIdA,\ \textcolor{keywordtype}{int}\ solverBodyIdB,\ \textcolor{keywordtype}{int}\ frictionIndex,\ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp,\ btScalar\ combinedTorsionalFriction,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos1,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos2,\ btCollisionObject*\ colObj0,\ btCollisionObject*\ colObj1,\ btScalar\ relaxation,\ btScalar\ desiredVelocity,\ btScalar\ cfmSlip)}
\DoxyCodeLine{00683\ \{}
\DoxyCodeLine{00684\ \ \ \ \ btSolverConstraint\&\ solverConstraint\ =\ m\_tmpSolverContactRollingFrictionConstraintPool.expandNonInitializing();}
\DoxyCodeLine{00685\ \ \ \ \ solverConstraint.m\_frictionIndex\ =\ frictionIndex;}
\DoxyCodeLine{00686\ \ \ \ \ setupTorsionalFrictionConstraint(solverConstraint,\ normalAxis,\ solverBodyIdA,\ solverBodyIdB,\ cp,\ combinedTorsionalFriction,\ rel\_pos1,\ rel\_pos2,}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ colObj0,\ colObj1,\ relaxation,\ desiredVelocity,\ cfmSlip);}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{keywordflow}{return}\ solverConstraint;}
\DoxyCodeLine{00689\ \}}
\DoxyCodeLine{00690\ }
\DoxyCodeLine{00691\ \textcolor{keywordtype}{int}\ btSequentialImpulseConstraintSolver::getOrInitSolverBody(btCollisionObject\&\ body,\ btScalar\ timeStep)}
\DoxyCodeLine{00692\ \{}
\DoxyCodeLine{00693\ \textcolor{preprocessor}{\#if\ BT\_THREADSAFE}}
\DoxyCodeLine{00694\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyId\ =\ -\/1;}
\DoxyCodeLine{00695\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ isRigidBodyType\ =\ \mbox{\hyperlink{classbt_rigid_body_ae4867a6bafb413e3a2e18dd1de125042}{btRigidBody::upcast}}(\&body)\ !=\ NULL;}
\DoxyCodeLine{00696\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ isStaticOrKinematic\ =\ body.isStaticOrKinematicObject();}
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ isKinematic\ =\ body.isKinematicObject();}
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{keywordflow}{if}\ (isRigidBodyType\ \&\&\ !isStaticOrKinematic)}
\DoxyCodeLine{00699\ \ \ \ \ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dynamic\ body}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Dynamic\ bodies\ can\ only\ be\ in\ one\ island,\ so\ it's\ safe\ to\ write\ to\ the\ companionId}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ solverBodyId\ =\ body.getCompanionId();}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (solverBodyId\ <\ 0)}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ solverBodyId\ =\ m\_tmpSolverBodyPool.size();}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ solverBody\ =\ m\_tmpSolverBodyPool.expand();}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ initSolverBody(\&solverBody,\ \&body,\ timeStep);}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ body.setCompanionId(solverBodyId);}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00710\ \ \ \ \ \}}
\DoxyCodeLine{00711\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (isRigidBodyType\ \&\&\ isKinematic)}
\DoxyCodeLine{00712\ \ \ \ \ \{}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ must\ test\ for\ kinematic\ before\ static\ because\ some\ kinematic\ objects\ also}}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ identify\ as\ "{}static"{}}}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Kinematic\ bodies\ can\ be\ in\ multiple\ islands\ at\ once,\ so\ it\ is\ a}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ race\ condition\ to\ write\ to\ them,\ so\ we\ use\ an\ alternate\ method}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ record\ the\ solverBodyId}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ uniqueId\ =\ body.getWorldArrayIndex();}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ INVALID\_SOLVER\_BODY\_ID\ =\ -\/1;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uniqueId\ >=\ m\_kinematicBodyUniqueIdToSolverBodyTable.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}())}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ m\_kinematicBodyUniqueIdToSolverBodyTable.resize(uniqueId\ +\ 1,\ INVALID\_SOLVER\_BODY\_ID);}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ solverBodyId\ =\ m\_kinematicBodyUniqueIdToSolverBodyTable[uniqueId];}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ no\ table\ entry\ yet,}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (solverBodyId\ ==\ INVALID\_SOLVER\_BODY\_ID)}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ create\ a\ table\ entry\ for\ this\ body}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ solverBodyId\ =\ m\_tmpSolverBodyPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ solverBody\ =\ m\_tmpSolverBodyPool.expand();}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ initSolverBody(\&solverBody,\ \&body,\ timeStep);}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ m\_kinematicBodyUniqueIdToSolverBodyTable[uniqueId]\ =\ solverBodyId;}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00736\ \ \ \ \ \}}
\DoxyCodeLine{00737\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00738\ \ \ \ \ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isMultiBodyType\ =\ (body.getInternalType()\ \&\ btCollisionObject::CO\_FEATHERSTONE\_LINK);}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incorrectly\ set\ collision\ object\ flags\ can\ degrade\ performance\ in\ various\ ways.}}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isMultiBodyType)}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(body.isStaticOrKinematicObject());}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \textcolor{comment}{//it\ could\ be\ a\ multibody\ link\ collider}}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ all\ fixed\ bodies\ (inf\ mass)\ get\ mapped\ to\ a\ single\ solver\ id}}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_fixedBodyId\ <\ 0)}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ m\_fixedBodyId\ =\ m\_tmpSolverBodyPool.size();}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ fixedBody\ =\ m\_tmpSolverBodyPool.expand();}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ initSolverBody(\&fixedBody,\ 0,\ timeStep);}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ solverBodyId\ =\ m\_fixedBodyId;}
\DoxyCodeLine{00754\ \ \ \ \ \}}
\DoxyCodeLine{00755\ \ \ \ \ btAssert(solverBodyId\ >=\ 0\ \&\&\ solverBodyId\ <\ m\_tmpSolverBodyPool.size());}
\DoxyCodeLine{00756\ \ \ \ \ \textcolor{keywordflow}{return}\ solverBodyId;}
\DoxyCodeLine{00757\ \textcolor{preprocessor}{\#else\ \ \ }\textcolor{comment}{//\ BT\_THREADSAFE}}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdA\ =\ -\/1;}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ \textcolor{keywordflow}{if}\ (body.getCompanionId()\ >=\ 0)}
\DoxyCodeLine{00762\ \ \ \ \ \{}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \textcolor{comment}{//body\ has\ already\ been\ converted}}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ solverBodyIdA\ =\ body.getCompanionId();}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ btAssert(solverBodyIdA\ <\ m\_tmpSolverBodyPool.size());}
\DoxyCodeLine{00766\ \ \ \ \ \}}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00768\ \ \ \ \ \{}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ rb\ =\ \mbox{\hyperlink{classbt_rigid_body_ae4867a6bafb413e3a2e18dd1de125042}{btRigidBody::upcast}}(\&body);}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \textcolor{comment}{//convert\ both\ active\ and\ kinematic\ objects\ (for\ their\ velocity)}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rb\ \&\&\ (rb-\/>getInvMass()\ ||\ rb-\/>isKinematicObject()))}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ solverBodyIdA\ =\ m\_tmpSolverBodyPool.size();}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ solverBody\ =\ m\_tmpSolverBodyPool.expand();}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ initSolverBody(\&solverBody,\ \&body,\ timeStep);}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ body.setCompanionId(solverBodyIdA);}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_fixedBodyId\ <\ 0)}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_fixedBodyId\ =\ m\_tmpSolverBodyPool.size();}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ fixedBody\ =\ m\_tmpSolverBodyPool.expand();}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ initSolverBody(\&fixedBody,\ 0,\ timeStep);}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_fixedBodyId;}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ return\ 0;//assume\ first\ one\ is\ a\ fixed\ solver\ body}}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00789\ \ \ \ \ \}}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ \textcolor{keywordflow}{return}\ solverBodyIdA;}
\DoxyCodeLine{00792\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ BT\_THREADSAFE}}
\DoxyCodeLine{00793\ \}}
\DoxyCodeLine{00794\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::setupContactConstraint(btSolverConstraint\&\ solverConstraint,}
\DoxyCodeLine{00797\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdA,\ \textcolor{keywordtype}{int}\ solverBodyIdB,}
\DoxyCodeLine{00798\ \ \ \ \ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,}
\DoxyCodeLine{00799\ \ \ \ \ btScalar\&\ relaxation,}
\DoxyCodeLine{00800\ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos1,\ \textcolor{keyword}{const}\ btVector3\&\ rel\_pos2)}
\DoxyCodeLine{00801\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \textcolor{comment}{//\ \ const\ btVector3\&\ pos1\ =\ cp.getPositionWorldOnA();}}
\DoxyCodeLine{00803\ \ \ \ \ \textcolor{comment}{//\ \ const\ btVector3\&\ pos2\ =\ cp.getPositionWorldOnB();}}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \ \ btSolverBody*\ bodyA\ =\ \&m\_tmpSolverBodyPool[solverBodyIdA];}
\DoxyCodeLine{00806\ \ \ \ \ btSolverBody*\ bodyB\ =\ \&m\_tmpSolverBodyPool[solverBodyIdB];}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ rb0\ =\ bodyA-\/>m\_originalBody;}
\DoxyCodeLine{00809\ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ rb1\ =\ bodyB-\/>m\_originalBody;}
\DoxyCodeLine{00810\ }
\DoxyCodeLine{00811\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ btVector3\ rel\_pos1\ =\ pos1\ -\/\ colObj0-\/>getWorldTransform().getOrigin();}}
\DoxyCodeLine{00812\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ btVector3\ rel\_pos2\ =\ pos2\ -\/\ colObj1-\/>getWorldTransform().getOrigin();}}
\DoxyCodeLine{00813\ \ \ \ \ \textcolor{comment}{//rel\_pos1\ =\ pos1\ -\/\ bodyA-\/>getWorldTransform().getOrigin();}}
\DoxyCodeLine{00814\ \ \ \ \ \textcolor{comment}{//rel\_pos2\ =\ pos2\ -\/\ bodyB-\/>getWorldTransform().getOrigin();}}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \ \ \ \ relaxation\ =\ infoGlobal.m\_sor;}
\DoxyCodeLine{00817\ \ \ \ \ btScalar\ invTimeStep\ =\ btScalar(1)\ /\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ \ \ \textcolor{comment}{//cfm\ =\ 1\ /\ \ \ \ \ \ \ (\ dt\ *\ kp\ +\ kd\ )}}
\DoxyCodeLine{00820\ \ \ \ \ \textcolor{comment}{//erp\ =\ dt\ *\ kp\ /\ (\ dt\ *\ kp\ +\ kd\ )}}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \ \ btScalar\ cfm\ =\ infoGlobal.m\_globalCfm;}
\DoxyCodeLine{00823\ \ \ \ \ btScalar\ erp\ =\ infoGlobal.m\_erp2;}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ \ \ \textcolor{keywordflow}{if}\ ((cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_HAS\_CONTACT\_CFM)\ ||\ (cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_HAS\_CONTACT\_ERP))}
\DoxyCodeLine{00826\ \ \ \ \ \{}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_HAS\_CONTACT\_CFM)}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \ \ \ \ cfm\ =\ cp.m\_contactCFM;}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_HAS\_CONTACT\_ERP)}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \ \ erp\ =\ cp.m\_contactERP;}
\DoxyCodeLine{00831\ \ \ \ \ \}}
\DoxyCodeLine{00832\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00833\ \ \ \ \ \{}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_CONTACT\_STIFFNESS\_DAMPING)}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ denom\ =\ (infoGlobal.m\_timeStep\ *\ cp.m\_combinedContactStiffness1\ +\ cp.m\_combinedContactDamping1);}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (denom\ <\ SIMD\_EPSILON)}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ denom\ =\ SIMD\_EPSILON;}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \ \ cfm\ =\ btScalar(1)\ /\ denom;}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ erp\ =\ (infoGlobal.m\_timeStep\ *\ cp.m\_combinedContactStiffness1)\ /\ denom;}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00844\ \ \ \ \ \}}
\DoxyCodeLine{00845\ }
\DoxyCodeLine{00846\ \ \ \ \ cfm\ *=\ invTimeStep;}
\DoxyCodeLine{00847\ }
\DoxyCodeLine{00848\ \ \ \ \ btVector3\ torqueAxis0\ =\ rel\_pos1.cross(cp.m\_normalWorldOnB);}
\DoxyCodeLine{00849\ \ \ \ \ solverConstraint.m\_angularComponentA\ =\ rb0\ ?\ rb0-\/>getInvInertiaTensorWorld()\ *\ torqueAxis0\ *\ rb0-\/>getAngularFactor()\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00850\ \ \ \ \ btVector3\ torqueAxis1\ =\ rel\_pos2.cross(cp.m\_normalWorldOnB);}
\DoxyCodeLine{00851\ \ \ \ \ solverConstraint.m\_angularComponentB\ =\ rb1\ ?\ rb1-\/>getInvInertiaTensorWorld()\ *\ -\/torqueAxis1\ *\ rb1-\/>getAngularFactor()\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00852\ }
\DoxyCodeLine{00853\ \ \ \ \ \{}
\DoxyCodeLine{00854\ \textcolor{preprocessor}{\#ifdef\ COMPUTE\_IMPULSE\_DENOM}}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ btScalar\ denom0\ =\ rb0-\/>computeImpulseDenominator(pos1,\ cp.m\_normalWorldOnB);}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ btScalar\ denom1\ =\ rb1-\/>computeImpulseDenominator(pos2,\ cp.m\_normalWorldOnB);}
\DoxyCodeLine{00857\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ btVector3\ vec;}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ btScalar\ denom0\ =\ 0.f;}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ btScalar\ denom1\ =\ 0.f;}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rb0)}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \ \ \ \ vec\ =\ (solverConstraint.m\_angularComponentA).cross(rel\_pos1);}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \ \ \ \ denom0\ =\ rb0-\/>getInvMass()\ +\ cp.m\_normalWorldOnB.dot(vec);}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rb1)}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ vec\ =\ (-\/solverConstraint.m\_angularComponentB).cross(rel\_pos2);}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ denom1\ =\ rb1-\/>getInvMass()\ +\ cp.m\_normalWorldOnB.dot(vec);}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00871\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//COMPUTE\_IMPULSE\_DENOM}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ btScalar\ denom\ =\ relaxation\ /\ (denom0\ +\ denom1\ +\ cfm);}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ solverConstraint.m\_jacDiagABInv\ =\ denom;}
\DoxyCodeLine{00875\ \ \ \ \ \}}
\DoxyCodeLine{00876\ }
\DoxyCodeLine{00877\ \ \ \ \ \textcolor{keywordflow}{if}\ (rb0)}
\DoxyCodeLine{00878\ \ \ \ \ \{}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal1\ =\ cp.m\_normalWorldOnB;}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos1CrossNormal\ =\ torqueAxis0;}
\DoxyCodeLine{00881\ \ \ \ \ \}}
\DoxyCodeLine{00882\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00883\ \ \ \ \ \{}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal1.setZero();}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos1CrossNormal.setZero();}
\DoxyCodeLine{00886\ \ \ \ \ \}}
\DoxyCodeLine{00887\ \ \ \ \ \textcolor{keywordflow}{if}\ (rb1)}
\DoxyCodeLine{00888\ \ \ \ \ \{}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal2\ =\ -\/cp.m\_normalWorldOnB;}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos2CrossNormal\ =\ -\/torqueAxis1;}
\DoxyCodeLine{00891\ \ \ \ \ \}}
\DoxyCodeLine{00892\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00893\ \ \ \ \ \{}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ solverConstraint.m\_contactNormal2.setZero();}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ solverConstraint.m\_relpos2CrossNormal.setZero();}
\DoxyCodeLine{00896\ \ \ \ \ \}}
\DoxyCodeLine{00897\ }
\DoxyCodeLine{00898\ \ \ \ \ btScalar\ restitution\ =\ 0.f;}
\DoxyCodeLine{00899\ \ \ \ \ btScalar\ penetration\ =\ cp.getDistance()\ +\ infoGlobal.m\_linearSlop;}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ \ \ \{}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ btVector3\ vel1,\ vel2;}
\DoxyCodeLine{00903\ }
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ vel1\ =\ rb0\ ?\ rb0-\/>getVelocityInLocalPoint(rel\_pos1)\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ vel2\ =\ rb1\ ?\ rb1-\/>getVelocityInLocalPoint(rel\_pos2)\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00906\ }
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ btVector3\ vel2\ =\ rb1\ ?\ rb1-\/>getVelocityInLocalPoint(rel\_pos2)\ :\ btVector3(0,0,0);}}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ btVector3\ vel\ =\ vel1\ -\/\ vel2;}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ btScalar\ rel\_vel\ =\ cp.m\_normalWorldOnB.dot(vel);}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ solverConstraint.m\_friction\ =\ cp.m\_combinedFriction;}
\DoxyCodeLine{00912\ }
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ restitution\ =\ restitutionCurve(rel\_vel,\ cp.m\_combinedRestitution,\ infoGlobal.m\_restitutionVelocityThreshold);}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (restitution\ <=\ btScalar(0.))}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \ \ \ \ \ \ restitution\ =\ 0.f;}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00918\ \ \ \ \ \}}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00921\ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_WARMSTARTING)}
\DoxyCodeLine{00922\ \ \ \ \ \{}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ solverConstraint.m\_appliedImpulse\ =\ cp.m\_appliedImpulse\ *\ infoGlobal.m\_warmstartingFactor;}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rb0)}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \ \ \ \ bodyA-\/>internalApplyImpulse(solverConstraint.m\_contactNormal1\ *\ bodyA-\/>internalGetInvMass(),\ solverConstraint.m\_angularComponentA,\ solverConstraint.m\_appliedImpulse);}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rb1)}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \ \ \ \ bodyB-\/>internalApplyImpulse(-\/solverConstraint.m\_contactNormal2\ *\ bodyB-\/>internalGetInvMass(),\ -\/solverConstraint.m\_angularComponentB,\ -\/(btScalar)solverConstraint.m\_appliedImpulse);}
\DoxyCodeLine{00928\ \ \ \ \ \}}
\DoxyCodeLine{00929\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00930\ \ \ \ \ \{}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ solverConstraint.m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{00932\ \ \ \ \ \}}
\DoxyCodeLine{00933\ }
\DoxyCodeLine{00934\ \ \ \ \ solverConstraint.m\_appliedPushImpulse\ =\ 0.f;}
\DoxyCodeLine{00935\ }
\DoxyCodeLine{00936\ \ \ \ \ \{}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ btVector3\ externalForceImpulseA\ =\ bodyA-\/>m\_originalBody\ ?\ bodyA-\/>m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ btVector3\ externalTorqueImpulseA\ =\ bodyA-\/>m\_originalBody\ ?\ bodyA-\/>m\_externalTorqueImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ btVector3\ externalForceImpulseB\ =\ bodyB-\/>m\_originalBody\ ?\ bodyB-\/>m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ btVector3\ externalTorqueImpulseB\ =\ bodyB-\/>m\_originalBody\ ?\ bodyB-\/>m\_externalTorqueImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \ \ \ \ \ \ btScalar\ vel1Dotn\ =\ solverConstraint.m\_contactNormal1.dot(bodyA-\/>m\_linearVelocity\ +\ externalForceImpulseA)\ +\ solverConstraint.m\_relpos1CrossNormal.dot(bodyA-\/>m\_angularVelocity\ +\ externalTorqueImpulseA);}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ btScalar\ vel2Dotn\ =\ solverConstraint.m\_contactNormal2.dot(bodyB-\/>m\_linearVelocity\ +\ externalForceImpulseB)\ +\ solverConstraint.m\_relpos2CrossNormal.dot(bodyB-\/>m\_angularVelocity\ +\ externalTorqueImpulseB);}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ btScalar\ rel\_vel\ =\ vel1Dotn\ +\ vel2Dotn;}
\DoxyCodeLine{00945\ }
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ btScalar\ positionalError\ =\ 0.f;}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ btScalar\ velocityError\ =\ restitution\ -\/\ rel\_vel;\ \ \textcolor{comment}{//\ *\ damping;}}
\DoxyCodeLine{00948\ }
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (penetration\ >\ 0)}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \ \ \ \ positionalError\ =\ 0;}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \ \ \ \ velocityError\ -\/=\ penetration\ *\ invTimeStep;}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \ \ \ \ positionalError\ =\ -\/penetration\ *\ erp\ *\ invTimeStep;}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00959\ }
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ btScalar\ penetrationImpulse\ =\ positionalError\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ btScalar\ velocityImpulse\ =\ velocityError\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00963\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!infoGlobal.m\_splitImpulse\ ||\ (penetration\ >\ infoGlobal.m\_splitImpulsePenetrationThreshold))}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//combine\ position\ and\ velocity\ into\ rhs}}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_rhs\ =\ penetrationImpulse\ +\ velocityImpulse;\ \ \textcolor{comment}{//-\/solverConstraint.m\_contactNormal1.dot(bodyA-\/>m\_externalForce*bodyA-\/>m\_invMass-\/bodyB-\/>m\_externalForce/bodyB-\/>m\_invMass)*solverConstraint.m\_jacDiagABInv;}}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_rhsPenetration\ =\ 0.f;}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//split\ position\ and\ velocity\ into\ rhs\ and\ m\_rhsPenetration}}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_rhs\ =\ velocityImpulse;}
\DoxyCodeLine{00973\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_rhsPenetration\ =\ penetrationImpulse;}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \ \ solverConstraint.m\_cfm\ =\ cfm\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{00976\ \ \ \ \ \ \ \ \ solverConstraint.m\_lowerLimit\ =\ 0;}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ solverConstraint.m\_upperLimit\ =\ 1e10f;}
\DoxyCodeLine{00978\ \ \ \ \ \}}
\DoxyCodeLine{00979\ \}}
\DoxyCodeLine{00980\ }
\DoxyCodeLine{00981\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::setFrictionConstraintImpulse(btSolverConstraint\&\ solverConstraint,}
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdA,\ \textcolor{keywordtype}{int}\ solverBodyIdB,}
\DoxyCodeLine{00983\ \ \ \ \ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{00984\ \{}
\DoxyCodeLine{00985\ \ \ \ \ \{}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \ \ btSolverConstraint\&\ frictionConstraint1\ =\ m\_tmpSolverContactFrictionConstraintPool[solverConstraint.m\_frictionIndex];}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00988\ \ \ \ \ \ \ \ \ frictionConstraint1.m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{00989\ \ \ \ \ \}}
\DoxyCodeLine{00990\ }
\DoxyCodeLine{00991\ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS))}
\DoxyCodeLine{00992\ \ \ \ \ \{}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ btSolverConstraint\&\ frictionConstraint2\ =\ m\_tmpSolverContactFrictionConstraintPool[solverConstraint.m\_frictionIndex\ +\ 1];}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ frictionConstraint2.m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{00996\ \ \ \ \ \}}
\DoxyCodeLine{00997\ \}}
\DoxyCodeLine{00998\ }
\DoxyCodeLine{00999\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::convertContact(btPersistentManifold*\ manifold,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01000\ \{}
\DoxyCodeLine{01001\ \ \ \ \ btCollisionObject\ *colObj0\ =\ 0,\ *colObj1\ =\ 0;}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \ \ colObj0\ =\ (btCollisionObject*)manifold-\/>getBody0();}
\DoxyCodeLine{01004\ \ \ \ \ colObj1\ =\ (btCollisionObject*)manifold-\/>getBody1();}
\DoxyCodeLine{01005\ }
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdA\ =\ getOrInitSolverBody(*colObj0,\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01007\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdB\ =\ getOrInitSolverBody(*colObj1,\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01008\ }
\DoxyCodeLine{01009\ \ \ \ \ \textcolor{comment}{//\ \ btRigidBody*\ bodyA\ =\ btRigidBody::upcast(colObj0);}}
\DoxyCodeLine{01010\ \ \ \ \ \textcolor{comment}{//\ \ btRigidBody*\ bodyB\ =\ btRigidBody::upcast(colObj1);}}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \ \ \ \ btSolverBody*\ solverBodyA\ =\ \&m\_tmpSolverBodyPool[solverBodyIdA];}
\DoxyCodeLine{01013\ \ \ \ \ btSolverBody*\ solverBodyB\ =\ \&m\_tmpSolverBodyPool[solverBodyIdB];}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01016\ \ \ \ \ \textcolor{keywordflow}{if}\ (!solverBodyA\ ||\ (solverBodyA-\/>m\_invMass.fuzzyZero()\ \&\&\ (!solverBodyB\ ||\ solverBodyB-\/>m\_invMass.fuzzyZero())))}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01018\ }
\DoxyCodeLine{01019\ \ \ \ \ \textcolor{keywordtype}{int}\ rollingFriction\ =\ 1;}
\DoxyCodeLine{01020\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ manifold-\/>getNumContacts();\ j++)}
\DoxyCodeLine{01021\ \ \ \ \ \{}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}\&\ cp\ =\ manifold-\/>getContactPoint(j);}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cp.getDistance()\ <=\ manifold-\/>getContactProcessingThreshold())}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ rel\_pos1;}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ rel\_pos2;}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ relaxation;}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ frictionIndex\ =\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverConstraint\&\ solverConstraint\ =\ m\_tmpSolverContactConstraintPool.expandNonInitializing();}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_solverBodyIdA\ =\ solverBodyIdA;}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_solverBodyIdB\ =\ solverBodyIdB;}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_originalContactPoint\ =\ \&cp;}
\DoxyCodeLine{01036\ }
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ pos1\ =\ cp.getPositionWorldOnA();}
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ pos2\ =\ cp.getPositionWorldOnB();}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ \ \ \ rel\_pos1\ =\ pos1\ -\/\ colObj0-\/>getWorldTransform().getOrigin();}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ rel\_pos2\ =\ pos2\ -\/\ colObj1-\/>getWorldTransform().getOrigin();}
\DoxyCodeLine{01042\ }
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ vel1;}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ vel2;}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ solverBodyA-\/>getVelocityInLocalPointNoDelta(rel\_pos1,\ vel1);}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ solverBodyB-\/>getVelocityInLocalPointNoDelta(rel\_pos2,\ vel2);}
\DoxyCodeLine{01048\ }
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ vel\ =\ vel1\ -\/\ vel2;}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ rel\_vel\ =\ cp.m\_normalWorldOnB.dot(vel);}
\DoxyCodeLine{01051\ }
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ \ \ setupContactConstraint(solverConstraint,\ solverBodyIdA,\ solverBodyIdB,\ cp,\ infoGlobal,\ relaxation,\ rel\_pos1,\ rel\_pos2);}
\DoxyCodeLine{01053\ }
\DoxyCodeLine{01055\ }
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_frictionIndex\ =\ m\_tmpSolverContactFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01057\ }
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((cp.m\_combinedRollingFriction\ >\ 0.f)\ \&\&\ (rollingFriction\ >\ 0))}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addTorsionalFrictionConstraint(cp.m\_normalWorldOnB,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ cp.m\_combinedSpinningFriction,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation);}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ axis0,\ axis1;}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btPlaneSpace1(cp.m\_normalWorldOnB,\ axis0,\ axis1);}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ axis0.normalize();}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ axis1.normalize();}
\DoxyCodeLine{01066\ }
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj0,\ axis0,\ btCollisionObject::CF\_ANISOTROPIC\_ROLLING\_FRICTION);}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj1,\ axis0,\ btCollisionObject::CF\_ANISOTROPIC\_ROLLING\_FRICTION);}
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj0,\ axis1,\ btCollisionObject::CF\_ANISOTROPIC\_ROLLING\_FRICTION);}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj1,\ axis1,\ btCollisionObject::CF\_ANISOTROPIC\_ROLLING\_FRICTION);}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (axis0.length()\ >\ 0.001)}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addTorsionalFrictionConstraint(axis0,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_combinedRollingFriction,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation);}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (axis1.length()\ >\ 0.001)}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addTorsionalFrictionConstraint(axis1,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_combinedRollingFriction,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation);}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01084\ }
\DoxyCodeLine{01095\ }
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!(infoGlobal.m\_solverMode\ \&\ SOLVER\_ENABLE\_FRICTION\_DIRECTION\_CACHING)\ ||\ !(cp.m\_contactPointFlags\ \&\ BT\_CONTACT\_FLAG\_LATERAL\_FRICTION\_INITIALIZED))}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_lateralFrictionDir1\ =\ vel\ -\/\ cp.m\_normalWorldOnB\ *\ rel\_vel;}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ lat\_rel\_vel\ =\ cp.m\_lateralFrictionDir1.length2();}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!(infoGlobal.m\_solverMode\ \&\ SOLVER\_DISABLE\_VELOCITY\_DEPENDENT\_FRICTION\_DIRECTION)\ \&\&\ lat\_rel\_vel\ >\ SIMD\_EPSILON)}
\DoxyCodeLine{01101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_lateralFrictionDir1\ *=\ 1.f\ /\ btSqrt(lat\_rel\_vel);}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj0,\ cp.m\_lateralFrictionDir1,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj1,\ cp.m\_lateralFrictionDir1,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addFrictionConstraint(cp.m\_lateralFrictionDir1,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation,\ infoGlobal);}
\DoxyCodeLine{01106\ }
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS))}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_lateralFrictionDir2\ =\ cp.m\_lateralFrictionDir1.cross(cp.m\_normalWorldOnB);}
\DoxyCodeLine{01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_lateralFrictionDir2.normalize();\ \ \textcolor{comment}{//??}}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj0,\ cp.m\_lateralFrictionDir2,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj1,\ cp.m\_lateralFrictionDir2,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addFrictionConstraint(cp.m\_lateralFrictionDir2,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation,\ infoGlobal);}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btPlaneSpace1(cp.m\_normalWorldOnB,\ cp.m\_lateralFrictionDir1,\ cp.m\_lateralFrictionDir2);}
\DoxyCodeLine{01119\ }
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj0,\ cp.m\_lateralFrictionDir1,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj1,\ cp.m\_lateralFrictionDir1,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addFrictionConstraint(cp.m\_lateralFrictionDir1,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation,\ infoGlobal);}
\DoxyCodeLine{01123\ }
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS))}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj0,\ cp.m\_lateralFrictionDir2,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ applyAnisotropicFriction(colObj1,\ cp.m\_lateralFrictionDir2,\ btCollisionObject::CF\_ANISOTROPIC\_FRICTION);}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addFrictionConstraint(cp.m\_lateralFrictionDir2,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation,\ infoGlobal);}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01130\ }
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS)\ \&\&\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_DISABLE\_VELOCITY\_DEPENDENT\_FRICTION\_DIRECTION))}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp.m\_contactPointFlags\ |=\ BT\_CONTACT\_FLAG\_LATERAL\_FRICTION\_INITIALIZED;}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addFrictionConstraint(cp.m\_lateralFrictionDir1,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation,\ infoGlobal,\ cp.m\_contactMotion1,\ cp.m\_frictionCFM);}
\DoxyCodeLine{01140\ }
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS))}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ addFrictionConstraint(cp.m\_lateralFrictionDir2,\ solverBodyIdA,\ solverBodyIdB,\ frictionIndex,\ cp,\ rel\_pos1,\ rel\_pos2,\ colObj0,\ colObj1,\ relaxation,\ infoGlobal,\ cp.m\_contactMotion2,\ cp.m\_frictionCFM);}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \ \ \ \ setFrictionConstraintImpulse(solverConstraint,\ solverBodyIdA,\ solverBodyIdB,\ cp,\ infoGlobal);}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01147\ \ \ \ \ \}}
\DoxyCodeLine{01148\ }
\DoxyCodeLine{01149\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::convertContacts(btPersistentManifold**\ manifoldPtr,\ \textcolor{keywordtype}{int}\ numManifolds,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01150\ \{}
\DoxyCodeLine{01151\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01152\ \ \ \ \ btPersistentManifold*\ manifold\ =\ 0;}
\DoxyCodeLine{01153\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ btCollisionObject*\ colObj0=0,*colObj1=0;}}
\DoxyCodeLine{01154\ }
\DoxyCodeLine{01155\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numManifolds;\ i++)}
\DoxyCodeLine{01156\ \ \ \ \ \{}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ manifold\ =\ manifoldPtr[i];}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ convertContact(manifold,\ infoGlobal);}
\DoxyCodeLine{01159\ \ \ \ \ \}}
\DoxyCodeLine{01160\ \}}
\DoxyCodeLine{01161\ }
\DoxyCodeLine{01162\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::convertJoint(btSolverConstraint*\ currentConstraintRow,}
\DoxyCodeLine{01163\ \ \ \ \ btTypedConstraint*\ constraint,}
\DoxyCodeLine{01164\ \ \ \ \ \textcolor{keyword}{const}\ btTypedConstraint::btConstraintInfo1\&\ info1,}
\DoxyCodeLine{01165\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdA,}
\DoxyCodeLine{01166\ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdB,}
\DoxyCodeLine{01167\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01168\ \{}
\DoxyCodeLine{01169\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}\&\ rbA\ =\ constraint-\/>getRigidBodyA();}
\DoxyCodeLine{01170\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}\&\ rbB\ =\ constraint-\/>getRigidBodyB();}
\DoxyCodeLine{01171\ }
\DoxyCodeLine{01172\ \ \ \ \ \textcolor{keyword}{const}\ btSolverBody*\ bodyAPtr\ =\ \&m\_tmpSolverBodyPool[solverBodyIdA];}
\DoxyCodeLine{01173\ \ \ \ \ \textcolor{keyword}{const}\ btSolverBody*\ bodyBPtr\ =\ \&m\_tmpSolverBodyPool[solverBodyIdB];}
\DoxyCodeLine{01174\ }
\DoxyCodeLine{01175\ \ \ \ \ \textcolor{keywordtype}{int}\ overrideNumSolverIterations\ =\ constraint-\/>getOverrideNumSolverIterations()\ >\ 0\ ?\ constraint-\/>getOverrideNumSolverIterations()\ :\ infoGlobal.m\_numIterations;}
\DoxyCodeLine{01176\ \ \ \ \ \textcolor{keywordflow}{if}\ (overrideNumSolverIterations\ >\ m\_maxOverrideNumSolverIterations)}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ m\_maxOverrideNumSolverIterations\ =\ overrideNumSolverIterations;}
\DoxyCodeLine{01178\ }
\DoxyCodeLine{01179\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ info1.m\_numConstraintRows;\ j++)}
\DoxyCodeLine{01180\ \ \ \ \ \{}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ memset(\&currentConstraintRow[j],\ 0,\ \textcolor{keyword}{sizeof}(btSolverConstraint));}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_lowerLimit\ =\ -\/SIMD\_INFINITY;}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_upperLimit\ =\ SIMD\_INFINITY;}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_appliedPushImpulse\ =\ 0.f;}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_solverBodyIdA\ =\ solverBodyIdA;}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_solverBodyIdB\ =\ solverBodyIdB;}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ currentConstraintRow[j].m\_overrideNumSolverIterations\ =\ overrideNumSolverIterations;}
\DoxyCodeLine{01189\ \ \ \ \ \}}
\DoxyCodeLine{01190\ }
\DoxyCodeLine{01191\ \ \ \ \ \textcolor{comment}{//\ these\ vectors\ are\ already\ cleared\ in\ initSolverBody,\ no\ need\ to\ redundantly\ clear\ again}}
\DoxyCodeLine{01192\ \ \ \ \ btAssert(bodyAPtr-\/>getDeltaLinearVelocity().isZero());}
\DoxyCodeLine{01193\ \ \ \ \ btAssert(bodyAPtr-\/>getDeltaAngularVelocity().isZero());}
\DoxyCodeLine{01194\ \ \ \ \ btAssert(bodyAPtr-\/>getPushVelocity().isZero());}
\DoxyCodeLine{01195\ \ \ \ \ btAssert(bodyAPtr-\/>getTurnVelocity().isZero());}
\DoxyCodeLine{01196\ \ \ \ \ btAssert(bodyBPtr-\/>getDeltaLinearVelocity().isZero());}
\DoxyCodeLine{01197\ \ \ \ \ btAssert(bodyBPtr-\/>getDeltaAngularVelocity().isZero());}
\DoxyCodeLine{01198\ \ \ \ \ btAssert(bodyBPtr-\/>getPushVelocity().isZero());}
\DoxyCodeLine{01199\ \ \ \ \ btAssert(bodyBPtr-\/>getTurnVelocity().isZero());}
\DoxyCodeLine{01200\ \ \ \ \ \textcolor{comment}{//bodyAPtr-\/>internalGetDeltaLinearVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01201\ \ \ \ \ \textcolor{comment}{//bodyAPtr-\/>internalGetDeltaAngularVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01202\ \ \ \ \ \textcolor{comment}{//bodyAPtr-\/>internalGetPushVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01203\ \ \ \ \ \textcolor{comment}{//bodyAPtr-\/>internalGetTurnVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01204\ \ \ \ \ \textcolor{comment}{//bodyBPtr-\/>internalGetDeltaLinearVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01205\ \ \ \ \ \textcolor{comment}{//bodyBPtr-\/>internalGetDeltaAngularVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01206\ \ \ \ \ \textcolor{comment}{//bodyBPtr-\/>internalGetPushVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01207\ \ \ \ \ \textcolor{comment}{//bodyBPtr-\/>internalGetTurnVelocity().setValue(0.f,0.f,0.f);}}
\DoxyCodeLine{01208\ }
\DoxyCodeLine{01209\ \ \ \ \ btTypedConstraint::btConstraintInfo2\ info2;}
\DoxyCodeLine{01210\ \ \ \ \ info2.fps\ =\ 1.f\ /\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{01211\ \ \ \ \ info2.erp\ =\ infoGlobal.m\_erp;}
\DoxyCodeLine{01212\ \ \ \ \ info2.m\_J1linearAxis\ =\ currentConstraintRow-\/>m\_contactNormal1;}
\DoxyCodeLine{01213\ \ \ \ \ info2.m\_J1angularAxis\ =\ currentConstraintRow-\/>m\_relpos1CrossNormal;}
\DoxyCodeLine{01214\ \ \ \ \ info2.m\_J2linearAxis\ =\ currentConstraintRow-\/>m\_contactNormal2;}
\DoxyCodeLine{01215\ \ \ \ \ info2.m\_J2angularAxis\ =\ currentConstraintRow-\/>m\_relpos2CrossNormal;}
\DoxyCodeLine{01216\ \ \ \ \ info2.rowskip\ =\ \textcolor{keyword}{sizeof}(btSolverConstraint)\ /\ \textcolor{keyword}{sizeof}(btScalar);\ \ \textcolor{comment}{//check\ this}}
\DoxyCodeLine{01218\ \ \ \ \ btAssert(info2.rowskip\ *\ \textcolor{keyword}{sizeof}(btScalar)\ ==\ \textcolor{keyword}{sizeof}(btSolverConstraint));}
\DoxyCodeLine{01219\ \ \ \ \ info2.m\_constraintError\ =\ \&currentConstraintRow-\/>m\_rhs;}
\DoxyCodeLine{01220\ \ \ \ \ currentConstraintRow-\/>m\_cfm\ =\ infoGlobal.m\_globalCfm;}
\DoxyCodeLine{01221\ \ \ \ \ info2.m\_damping\ =\ infoGlobal.m\_damping;}
\DoxyCodeLine{01222\ \ \ \ \ info2.cfm\ =\ \&currentConstraintRow-\/>m\_cfm;}
\DoxyCodeLine{01223\ \ \ \ \ info2.m\_lowerLimit\ =\ \&currentConstraintRow-\/>m\_lowerLimit;}
\DoxyCodeLine{01224\ \ \ \ \ info2.m\_upperLimit\ =\ \&currentConstraintRow-\/>m\_upperLimit;}
\DoxyCodeLine{01225\ \ \ \ \ info2.m\_numIterations\ =\ infoGlobal.m\_numIterations;}
\DoxyCodeLine{01226\ \ \ \ \ constraint-\/>getInfo2(\&info2);}
\DoxyCodeLine{01227\ }
\DoxyCodeLine{01229\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ info1.m\_numConstraintRows;\ j++)}
\DoxyCodeLine{01230\ \ \ \ \ \{}
\DoxyCodeLine{01231\ \ \ \ \ \ \ \ \ btSolverConstraint\&\ solverConstraint\ =\ currentConstraintRow[j];}
\DoxyCodeLine{01232\ }
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (solverConstraint.m\_upperLimit\ >=\ constraint-\/>getBreakingImpulseThreshold())}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_upperLimit\ =\ constraint-\/>getBreakingImpulseThreshold();}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01237\ }
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (solverConstraint.m\_lowerLimit\ <=\ -\/constraint-\/>getBreakingImpulseThreshold())}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_lowerLimit\ =\ -\/constraint-\/>getBreakingImpulseThreshold();}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01242\ }
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ solverConstraint.m\_originalContactPoint\ =\ constraint;}
\DoxyCodeLine{01244\ }
\DoxyCodeLine{01245\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ ftorqueAxis1\ =\ solverConstraint.m\_relpos1CrossNormal;}
\DoxyCodeLine{01247\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentA\ =\ constraint-\/>getRigidBodyA().getInvInertiaTensorWorld()\ *\ ftorqueAxis1\ *\ constraint-\/>getRigidBodyA().getAngularFactor();}
\DoxyCodeLine{01248\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ ftorqueAxis2\ =\ solverConstraint.m\_relpos2CrossNormal;}
\DoxyCodeLine{01251\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_angularComponentB\ =\ constraint-\/>getRigidBodyB().getInvInertiaTensorWorld()\ *\ ftorqueAxis2\ *\ constraint-\/>getRigidBodyB().getAngularFactor();}
\DoxyCodeLine{01252\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01253\ }
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ iMJlA\ =\ solverConstraint.m\_contactNormal1\ *\ rbA.getInvMass();}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ iMJaA\ =\ rbA.getInvInertiaTensorWorld()\ *\ solverConstraint.m\_relpos1CrossNormal;}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ iMJlB\ =\ solverConstraint.m\_contactNormal2\ *\ rbB.getInvMass();\ \ \textcolor{comment}{//sign\ of\ normal?}}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ iMJaB\ =\ rbB.getInvInertiaTensorWorld()\ *\ solverConstraint.m\_relpos2CrossNormal;}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01260\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ sum\ =\ iMJlA.dot(solverConstraint.m\_contactNormal1);}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ \ \ \ \ sum\ +=\ iMJaA.dot(solverConstraint.m\_relpos1CrossNormal);}
\DoxyCodeLine{01262\ \ \ \ \ \ \ \ \ \ \ \ \ sum\ +=\ iMJlB.dot(solverConstraint.m\_contactNormal2);}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \ \ \ \ sum\ +=\ iMJaB.dot(solverConstraint.m\_relpos2CrossNormal);}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ fsum\ =\ btFabs(sum);}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(fsum\ >\ SIMD\_EPSILON);}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ sorRelaxation\ =\ 1.f;\ \ \textcolor{comment}{//todo:\ get\ from\ globalInfo?}}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_jacDiagABInv\ =\ fsum\ >\ SIMD\_EPSILON\ ?\ sorRelaxation\ /\ sum\ :\ 0.f;}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01269\ }
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ rel\_vel;}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ externalForceImpulseA\ =\ bodyAPtr-\/>m\_originalBody\ ?\ bodyAPtr-\/>m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ externalTorqueImpulseA\ =\ bodyAPtr-\/>m\_originalBody\ ?\ bodyAPtr-\/>m\_externalTorqueImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{01274\ }
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ externalForceImpulseB\ =\ bodyBPtr-\/>m\_originalBody\ ?\ bodyBPtr-\/>m\_externalForceImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ externalTorqueImpulseB\ =\ bodyBPtr-\/>m\_originalBody\ ?\ bodyBPtr-\/>m\_externalTorqueImpulse\ :\ btVector3(0,\ 0,\ 0);}
\DoxyCodeLine{01277\ }
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ vel1Dotn\ =\ solverConstraint.m\_contactNormal1.dot(rbA.getLinearVelocity()\ +\ externalForceImpulseA)\ +\ solverConstraint.m\_relpos1CrossNormal.dot(rbA.getAngularVelocity()\ +\ externalTorqueImpulseA);}
\DoxyCodeLine{01279\ }
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ vel2Dotn\ =\ solverConstraint.m\_contactNormal2.dot(rbB.getLinearVelocity()\ +\ externalForceImpulseB)\ +\ solverConstraint.m\_relpos2CrossNormal.dot(rbB.getAngularVelocity()\ +\ externalTorqueImpulseB);}
\DoxyCodeLine{01281\ }
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \ \ \ \ rel\_vel\ =\ vel1Dotn\ +\ vel2Dotn;}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ restitution\ =\ 0.f;}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ positionalError\ =\ solverConstraint.m\_rhs;\ \ \textcolor{comment}{//already\ filled\ in\ by\ getConstraintInfo2}}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ velocityError\ =\ restitution\ -\/\ rel\_vel\ *\ info2.m\_damping;}
\DoxyCodeLine{01286\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ penetrationImpulse\ =\ positionalError\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ velocityImpulse\ =\ velocityError\ *\ solverConstraint.m\_jacDiagABInv;}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_rhs\ =\ penetrationImpulse\ +\ velocityImpulse;}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ solverConstraint.m\_appliedImpulse\ =\ 0.f;}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01291\ \ \ \ \ \}}
\DoxyCodeLine{01292\ \}}
\DoxyCodeLine{01293\ }
\DoxyCodeLine{01294\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::convertJoints(btTypedConstraint**\ constraints,\ \textcolor{keywordtype}{int}\ numConstraints,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01295\ \{}
\DoxyCodeLine{01296\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}convertJoints"{}});}
\DoxyCodeLine{01297\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ numConstraints;\ j++)}
\DoxyCodeLine{01298\ \ \ \ \ \{}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ btTypedConstraint*\ constraint\ =\ constraints[j];}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ constraint-\/>buildJacobian();}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ constraint-\/>internalSetAppliedImpulse(0.0f);}
\DoxyCodeLine{01302\ \ \ \ \ \}}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \ \ \textcolor{keywordtype}{int}\ totalNumRows\ =\ 0;}
\DoxyCodeLine{01305\ }
\DoxyCodeLine{01306\ \ \ \ \ m\_tmpConstraintSizesPool.resizeNoInitialize(numConstraints);}
\DoxyCodeLine{01307\ \ \ \ \ \textcolor{comment}{//calculate\ the\ total\ number\ of\ contraint\ rows}}
\DoxyCodeLine{01308\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numConstraints;\ i++)}
\DoxyCodeLine{01309\ \ \ \ \ \{}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ btTypedConstraint::btConstraintInfo1\&\ info1\ =\ m\_tmpConstraintSizesPool[i];}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ btJointFeedback*\ fb\ =\ constraints[i]-\/>getJointFeedback();}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fb)}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedForceBodyA.setZero();}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedTorqueBodyA.setZero();}
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedForceBodyB.setZero();}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedTorqueBodyB.setZero();}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01319\ }
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (constraints[i]-\/>isEnabled())}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \ \ \ \ constraints[i]-\/>getInfo1(\&info1);}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \ \ info1.m\_numConstraintRows\ =\ 0;}
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ \ \ \ \ info1.nub\ =\ 0;}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ totalNumRows\ +=\ info1.m\_numConstraintRows;}
\DoxyCodeLine{01330\ \ \ \ \ \}}
\DoxyCodeLine{01331\ \ \ \ \ m\_tmpSolverNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(totalNumRows);}
\DoxyCodeLine{01332\ }
\DoxyCodeLine{01334\ \ \ \ \ \textcolor{keywordtype}{int}\ currentRow\ =\ 0;}
\DoxyCodeLine{01335\ }
\DoxyCodeLine{01336\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numConstraints;\ i++)}
\DoxyCodeLine{01337\ \ \ \ \ \{}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btTypedConstraint::btConstraintInfo1\&\ info1\ =\ m\_tmpConstraintSizesPool[i];}
\DoxyCodeLine{01339\ }
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (info1.m\_numConstraintRows)}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(currentRow\ <\ totalNumRows);}
\DoxyCodeLine{01343\ }
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverConstraint*\ currentConstraintRow\ =\ \&m\_tmpSolverNonContactConstraintPool[currentRow];}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \ \ \ \ btTypedConstraint*\ constraint\ =\ constraints[i];}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}\&\ rbA\ =\ constraint-\/>getRigidBodyA();}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}\&\ rbB\ =\ constraint-\/>getRigidBodyB();}
\DoxyCodeLine{01348\ }
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdA\ =\ getOrInitSolverBody(rbA,\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ solverBodyIdB\ =\ getOrInitSolverBody(rbB,\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01351\ }
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ convertJoint(currentConstraintRow,\ constraint,\ info1,\ solverBodyIdA,\ solverBodyIdB,\ infoGlobal);}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ currentRow\ +=\ info1.m\_numConstraintRows;}
\DoxyCodeLine{01355\ \ \ \ \ \}}
\DoxyCodeLine{01356\ \}}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01358\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::convertBodies(btCollisionObject**\ bodies,\ \textcolor{keywordtype}{int}\ numBodies,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01359\ \{}
\DoxyCodeLine{01360\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}convertBodies"{}});}
\DoxyCodeLine{01361\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numBodies;\ i++)}
\DoxyCodeLine{01362\ \ \ \ \ \{}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ bodies[i]-\/>setCompanionId(-\/1);}
\DoxyCodeLine{01364\ \ \ \ \ \}}
\DoxyCodeLine{01365\ \textcolor{preprocessor}{\#if\ BT\_THREADSAFE}}
\DoxyCodeLine{01366\ \ \ \ \ m\_kinematicBodyUniqueIdToSolverBodyTable.resize(0);}
\DoxyCodeLine{01367\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ BT\_THREADSAFE}}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ \ \ \ \ m\_tmpSolverBodyPool.reserve(numBodies\ +\ 1);}
\DoxyCodeLine{01370\ \ \ \ \ m\_tmpSolverBodyPool.resize(0);}
\DoxyCodeLine{01371\ }
\DoxyCodeLine{01372\ \ \ \ \ \textcolor{comment}{//btSolverBody\&\ fixedBody\ =\ m\_tmpSolverBodyPool.expand();}}
\DoxyCodeLine{01373\ \ \ \ \ \textcolor{comment}{//initSolverBody(\&fixedBody,0);}}
\DoxyCodeLine{01374\ }
\DoxyCodeLine{01375\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numBodies;\ i++)}
\DoxyCodeLine{01376\ \ \ \ \ \{}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bodyId\ =\ getOrInitSolverBody(*bodies[i],\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01378\ }
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ body\ =\ \mbox{\hyperlink{classbt_rigid_body_ae4867a6bafb413e3a2e18dd1de125042}{btRigidBody::upcast}}(bodies[i]);}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (body\ \&\&\ body-\/>getInvMass())}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ solverBody\ =\ m\_tmpSolverBodyPool[bodyId];}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \ \ \ \ btVector3\ gyroForce(0,\ 0,\ 0);}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (body-\/>getFlags()\ \&\ BT\_ENABLE\_GYROSCOPIC\_FORCE\_EXPLICIT)}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gyroForce\ =\ body-\/>\mbox{\hyperlink{classbt_rigid_body_af9fa0fe9670f6b620c48a7e1c811b4b6}{computeGyroscopicForceExplicit}}(infoGlobal.m\_maxGyroscopicForce);}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solverBody.m\_externalTorqueImpulse\ -\/=\ gyroForce\ *\ body-\/>getInvInertiaTensorWorld()\ *\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (body-\/>getFlags()\ \&\ BT\_ENABLE\_GYROSCOPIC\_FORCE\_IMPLICIT\_WORLD)}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gyroForce\ =\ body-\/>\mbox{\hyperlink{classbt_rigid_body_a79f82cfc25b4cfe73e93720dedc62bb8}{computeGyroscopicImpulseImplicit\_World}}(infoGlobal.m\_timeStep);}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solverBody.m\_externalTorqueImpulse\ +=\ gyroForce;}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (body-\/>getFlags()\ \&\ BT\_ENABLE\_GYROSCOPIC\_FORCE\_IMPLICIT\_BODY)}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gyroForce\ =\ body-\/>\mbox{\hyperlink{classbt_rigid_body_a820e3d206da0673ce782fa57ae701437}{computeGyroscopicImpulseImplicit\_Body}}(infoGlobal.m\_timeStep);}
\DoxyCodeLine{01397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solverBody.m\_externalTorqueImpulse\ +=\ gyroForce;}
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01400\ \ \ \ \ \}}
\DoxyCodeLine{01401\ \}}
\DoxyCodeLine{01402\ }
\DoxyCodeLine{01403\ btScalar\ btSequentialImpulseConstraintSolver::solveGroupCacheFriendlySetup(btCollisionObject**\ bodies,\ \textcolor{keywordtype}{int}\ numBodies,\ btPersistentManifold**\ manifoldPtr,\ \textcolor{keywordtype}{int}\ numManifolds,\ btTypedConstraint**\ constraints,\ \textcolor{keywordtype}{int}\ numConstraints,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ \mbox{\hyperlink{classbt_i_debug_draw}{btIDebugDraw}}*\ debugDrawer)}
\DoxyCodeLine{01404\ \{}
\DoxyCodeLine{01405\ \ \ \ \ m\_fixedBodyId\ =\ -\/1;}
\DoxyCodeLine{01406\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}solveGroupCacheFriendlySetup"{}});}
\DoxyCodeLine{01407\ \ \ \ \ (void)debugDrawer;}
\DoxyCodeLine{01408\ }
\DoxyCodeLine{01409\ \ \ \ \ \textcolor{comment}{//\ if\ solver\ mode\ has\ changed,}}
\DoxyCodeLine{01410\ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_solverMode\ !=\ m\_cachedSolverMode)}
\DoxyCodeLine{01411\ \ \ \ \ \{}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ update\ solver\ functions\ to\ use\ SIMD\ or\ non-\/SIMD}}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ useSimd\ =\ !!(infoGlobal.m\_solverMode\ \&\ SOLVER\_SIMD);}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ setupSolverFunctions(useSimd);}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ m\_cachedSolverMode\ =\ infoGlobal.m\_solverMode;}
\DoxyCodeLine{01416\ \ \ \ \ \}}
\DoxyCodeLine{01417\ \ \ \ \ m\_maxOverrideNumSolverIterations\ =\ 0;}
\DoxyCodeLine{01418\ }
\DoxyCodeLine{01419\ \textcolor{preprocessor}{\#ifdef\ BT\_ADDITIONAL\_DEBUG}}
\DoxyCodeLine{01420\ \ \ \ \ \textcolor{comment}{//make\ sure\ that\ dynamic\ bodies\ exist\ for\ all\ (enabled)\ constraints}}
\DoxyCodeLine{01421\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numConstraints;\ i++)}
\DoxyCodeLine{01422\ \ \ \ \ \{}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ btTypedConstraint*\ constraint\ =\ constraints[i];}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (constraint-\/>isEnabled())}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!constraint-\/>getRigidBodyA().isStaticOrKinematicObject())}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ b\ =\ 0;\ b\ <\ numBodies;\ b++)}
\DoxyCodeLine{01430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\&constraint-\/>getRigidBodyA()\ ==\ bodies[b])}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(found);}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!constraint-\/>getRigidBodyB().isStaticOrKinematicObject())}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ b\ =\ 0;\ b\ <\ numBodies;\ b++)}
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\&constraint-\/>getRigidBodyB()\ ==\ bodies[b])}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(found);}
\DoxyCodeLine{01451\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01453\ \ \ \ \ \}}
\DoxyCodeLine{01454\ \ \ \ \ \textcolor{comment}{//make\ sure\ that\ dynamic\ bodies\ exist\ for\ all\ contact\ manifolds}}
\DoxyCodeLine{01455\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numManifolds;\ i++)}
\DoxyCodeLine{01456\ \ \ \ \ \{}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!manifoldPtr[i]-\/>getBody0()-\/>isStaticOrKinematicObject())}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01459\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ b\ =\ 0;\ b\ <\ numBodies;\ b++)}
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (manifoldPtr[i]-\/>getBody0()\ ==\ bodies[b])}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01468\ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(found);}
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!manifoldPtr[i]-\/>getBody1()-\/>isStaticOrKinematicObject())}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ b\ =\ 0;\ b\ <\ numBodies;\ b++)}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (manifoldPtr[i]-\/>getBody1()\ ==\ bodies[b])}
\DoxyCodeLine{01476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \ \ \ \ btAssert(found);}
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01483\ \ \ \ \ \}}
\DoxyCodeLine{01484\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//BT\_ADDITIONAL\_DEBUG}}
\DoxyCodeLine{01485\ }
\DoxyCodeLine{01486\ \ \ \ \ \textcolor{comment}{//convert\ all\ bodies}}
\DoxyCodeLine{01487\ \ \ \ \ convertBodies(bodies,\ numBodies,\ infoGlobal);}
\DoxyCodeLine{01488\ }
\DoxyCodeLine{01489\ \ \ \ \ convertJoints(constraints,\ numConstraints,\ infoGlobal);}
\DoxyCodeLine{01490\ }
\DoxyCodeLine{01491\ \ \ \ \ convertContacts(manifoldPtr,\ numManifolds,\ infoGlobal);}
\DoxyCodeLine{01492\ }
\DoxyCodeLine{01493\ \ \ \ \ \textcolor{comment}{//\ \ btContactSolverInfo\ info\ =\ infoGlobal;}}
\DoxyCodeLine{01494\ }
\DoxyCodeLine{01495\ \ \ \ \ \textcolor{keywordtype}{int}\ numNonContactPool\ =\ m\_tmpSolverNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01496\ \ \ \ \ \textcolor{keywordtype}{int}\ numConstraintPool\ =\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01497\ \ \ \ \ \textcolor{keywordtype}{int}\ numFrictionPool\ =\ m\_tmpSolverContactFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01498\ }
\DoxyCodeLine{01500\ \ \ \ \ m\_orderNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(numNonContactPool);}
\DoxyCodeLine{01501\ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS))}
\DoxyCodeLine{01502\ \ \ \ \ \ \ \ \ m\_orderTmpConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(numConstraintPool\ *\ 2);}
\DoxyCodeLine{01503\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ m\_orderTmpConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(numConstraintPool);}
\DoxyCodeLine{01505\ }
\DoxyCodeLine{01506\ \ \ \ \ m\_orderFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(numFrictionPool);}
\DoxyCodeLine{01507\ \ \ \ \ \{}
\DoxyCodeLine{01508\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numNonContactPool;\ i++)}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderNonContactConstraintPool[i]\ =\ i;}
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numConstraintPool;\ i++)}
\DoxyCodeLine{01514\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderTmpConstraintPool[i]\ =\ i;}
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ numFrictionPool;\ i++)}
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderFrictionConstraintPool[i]\ =\ i;}
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01521\ \ \ \ \ \}}
\DoxyCodeLine{01522\ }
\DoxyCodeLine{01523\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.f;}
\DoxyCodeLine{01524\ \}}
\DoxyCodeLine{01525\ }
\DoxyCodeLine{01526\ btScalar\ btSequentialImpulseConstraintSolver::solveSingleIteration(\textcolor{keywordtype}{int}\ iteration,\ btCollisionObject**\ \textcolor{comment}{/*bodies\ */},\ \textcolor{keywordtype}{int}\ \textcolor{comment}{/*numBodies*/},\ btPersistentManifold**\ \textcolor{comment}{/*manifoldPtr*/},\ \textcolor{keywordtype}{int}\ \textcolor{comment}{/*numManifolds*/},\ btTypedConstraint**\ constraints,\ \textcolor{keywordtype}{int}\ numConstraints,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ \mbox{\hyperlink{classbt_i_debug_draw}{btIDebugDraw}}*\ \textcolor{comment}{/*debugDrawer*/})}
\DoxyCodeLine{01527\ \{}
\DoxyCodeLine{01528\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}solveSingleIteration"{}});}
\DoxyCodeLine{01529\ \ \ \ \ btScalar\ leastSquaresResidual\ =\ 0.f;}
\DoxyCodeLine{01530\ }
\DoxyCodeLine{01531\ \ \ \ \ \textcolor{keywordtype}{int}\ numNonContactPool\ =\ m\_tmpSolverNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01532\ \ \ \ \ \textcolor{keywordtype}{int}\ numConstraintPool\ =\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01533\ \ \ \ \ \textcolor{keywordtype}{int}\ numFrictionPool\ =\ m\_tmpSolverContactFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01534\ }
\DoxyCodeLine{01535\ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_RANDMIZE\_ORDER)}
\DoxyCodeLine{01536\ \ \ \ \ \{}
\DoxyCodeLine{01537\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (1)\ \ \textcolor{comment}{//\ uncomment\ this\ for\ a\ bit\ less\ random\ ((iteration\ \&\ 7)\ ==\ 0)}}
\DoxyCodeLine{01538\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ numNonContactPool;\ ++j)}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\ =\ m\_orderNonContactConstraintPool[j];}
\DoxyCodeLine{01542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ swapi\ =\ btRandInt2(j\ +\ 1);}
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderNonContactConstraintPool[j]\ =\ m\_orderNonContactConstraintPool[swapi];}
\DoxyCodeLine{01544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderNonContactConstraintPool[swapi]\ =\ tmp;}
\DoxyCodeLine{01545\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01546\ }
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//contact/friction\ constraints\ are\ not\ solved\ more\ than}}
\DoxyCodeLine{01548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (iteration\ <\ infoGlobal.m\_numIterations)}
\DoxyCodeLine{01549\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ numConstraintPool;\ ++j)}
\DoxyCodeLine{01551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\ =\ m\_orderTmpConstraintPool[j];}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ swapi\ =\ btRandInt2(j\ +\ 1);}
\DoxyCodeLine{01554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderTmpConstraintPool[j]\ =\ m\_orderTmpConstraintPool[swapi];}
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderTmpConstraintPool[swapi]\ =\ tmp;}
\DoxyCodeLine{01556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ numFrictionPool;\ ++j)}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\ =\ m\_orderFrictionConstraintPool[j];}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ swapi\ =\ btRandInt2(j\ +\ 1);}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderFrictionConstraintPool[j]\ =\ m\_orderFrictionConstraintPool[swapi];}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_orderFrictionConstraintPool[swapi]\ =\ tmp;}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01565\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01567\ \ \ \ \ \}}
\DoxyCodeLine{01568\ }
\DoxyCodeLine{01570\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ m\_tmpSolverNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ j++)}
\DoxyCodeLine{01571\ \ \ \ \ \{}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ btSolverConstraint\&\ constraint\ =\ m\_tmpSolverNonContactConstraintPool[m\_orderNonContactConstraintPool[j]];}
\DoxyCodeLine{01573\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (iteration\ <\ constraint.m\_overrideNumSolverIterations)}
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowGeneric(m\_tmpSolverBodyPool[constraint.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[constraint.m\_solverBodyIdB],\ constraint);}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01578\ \ \ \ \ \}}
\DoxyCodeLine{01579\ }
\DoxyCodeLine{01580\ \ \ \ \ \textcolor{keywordflow}{if}\ (iteration\ <\ infoGlobal.m\_numIterations)}
\DoxyCodeLine{01581\ \ \ \ \ \{}
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ numConstraints;\ j++)}
\DoxyCodeLine{01583\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (constraints[j]-\/>isEnabled())}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bodyAid\ =\ getOrInitSolverBody(constraints[j]-\/>getRigidBodyA(),\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bodyBid\ =\ getOrInitSolverBody(constraints[j]-\/>getRigidBodyB(),\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ bodyA\ =\ m\_tmpSolverBodyPool[bodyAid];}
\DoxyCodeLine{01589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btSolverBody\&\ bodyB\ =\ m\_tmpSolverBodyPool[bodyBid];}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ constraints[j]-\/>solveConstraintObsolete(bodyA,\ bodyB,\ infoGlobal.m\_timeStep);}
\DoxyCodeLine{01591\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01593\ }
\DoxyCodeLine{01595\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_INTERLEAVE\_CONTACT\_AND\_FRICTION\_CONSTRAINTS)}
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numPoolConstraints\ =\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01598\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ multiplier\ =\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS)\ ?\ 2\ :\ 1;}
\DoxyCodeLine{01599\ }
\DoxyCodeLine{01600\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ c\ =\ 0;\ c\ <\ numPoolConstraints;\ c++)}
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ totalImpulse\ =\ 0;}
\DoxyCodeLine{01603\ }
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactConstraintPool[m\_orderTmpConstraintPool[c]];}
\DoxyCodeLine{01606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowLowerLimit(m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdB],\ solveManifold);}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01608\ }
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ totalImpulse\ =\ solveManifold.m\_appliedImpulse;}
\DoxyCodeLine{01610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ applyFriction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (applyFriction)}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactFrictionConstraintPool[m\_orderFrictionConstraintPool[c\ *\ multiplier]];}
\DoxyCodeLine{01616\ }
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (totalImpulse\ >\ btScalar(0))}
\DoxyCodeLine{01618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solveManifold.m\_lowerLimit\ =\ -\/(solveManifold.m\_friction\ *\ totalImpulse);}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solveManifold.m\_upperLimit\ =\ solveManifold.m\_friction\ *\ totalImpulse;}
\DoxyCodeLine{01621\ }
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowGeneric(m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdB],\ solveManifold);}
\DoxyCodeLine{01623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01626\ }
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS)}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactFrictionConstraintPool[m\_orderFrictionConstraintPool[c\ *\ multiplier\ +\ 1]];}
\DoxyCodeLine{01630\ }
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (totalImpulse\ >\ btScalar(0))}
\DoxyCodeLine{01632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solveManifold.m\_lowerLimit\ =\ -\/(solveManifold.m\_friction\ *\ totalImpulse);}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solveManifold.m\_upperLimit\ =\ solveManifold.m\_friction\ *\ totalImpulse;}
\DoxyCodeLine{01635\ }
\DoxyCodeLine{01636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowGeneric(m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdB],\ solveManifold);}
\DoxyCodeLine{01637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \textcolor{comment}{//SOLVER\_INTERLEAVE\_CONTACT\_AND\_FRICTION\_CONSTRAINTS}}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//solve\ the\ friction\ constraints\ after\ all\ contact\ constraints,\ don't\ interleave\ them}}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numPoolConstraints\ =\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ j;}
\DoxyCodeLine{01648\ }
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ numPoolConstraints;\ j++)}
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactConstraintPool[m\_orderTmpConstraintPool[j]];}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowLowerLimit(m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdB],\ solveManifold);}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01655\ }
\DoxyCodeLine{01657\ }
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numFrictionPoolConstraints\ =\ m\_tmpSolverContactFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ numFrictionPoolConstraints;\ j++)}
\DoxyCodeLine{01660\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactFrictionConstraintPool[m\_orderFrictionConstraintPool[j]];}
\DoxyCodeLine{01662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ totalImpulse\ =\ m\_tmpSolverContactConstraintPool[solveManifold.m\_frictionIndex].m\_appliedImpulse;}
\DoxyCodeLine{01663\ }
\DoxyCodeLine{01664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (totalImpulse\ >\ btScalar(0))}
\DoxyCodeLine{01665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solveManifold.m\_lowerLimit\ =\ -\/(solveManifold.m\_friction\ *\ totalImpulse);}
\DoxyCodeLine{01667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solveManifold.m\_upperLimit\ =\ solveManifold.m\_friction\ *\ totalImpulse;}
\DoxyCodeLine{01668\ }
\DoxyCodeLine{01669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowGeneric(m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdB],\ solveManifold);}
\DoxyCodeLine{01670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01672\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01673\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01674\ }
\DoxyCodeLine{01675\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numRollingFrictionPoolConstraints\ =\ m\_tmpSolverContactRollingFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ numRollingFrictionPoolConstraints;\ j++)}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ \ \ \ \ btSolverConstraint\&\ rollingFrictionConstraint\ =\ m\_tmpSolverContactRollingFrictionConstraintPool[j];}
\DoxyCodeLine{01679\ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ totalImpulse\ =\ m\_tmpSolverContactConstraintPool[rollingFrictionConstraint.m\_frictionIndex].m\_appliedImpulse;}
\DoxyCodeLine{01680\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (totalImpulse\ >\ btScalar(0))}
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ rollingFrictionMagnitude\ =\ rollingFrictionConstraint.m\_friction\ *\ totalImpulse;}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rollingFrictionMagnitude\ >\ rollingFrictionConstraint.m\_friction)}
\DoxyCodeLine{01684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rollingFrictionMagnitude\ =\ rollingFrictionConstraint.m\_friction;}
\DoxyCodeLine{01685\ }
\DoxyCodeLine{01686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rollingFrictionConstraint.m\_lowerLimit\ =\ -\/rollingFrictionMagnitude;}
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rollingFrictionConstraint.m\_upperLimit\ =\ rollingFrictionMagnitude;}
\DoxyCodeLine{01688\ }
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSingleConstraintRowGeneric(m\_tmpSolverBodyPool[rollingFrictionConstraint.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[rollingFrictionConstraint.m\_solverBodyIdB],\ rollingFrictionConstraint);}
\DoxyCodeLine{01690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01693\ \ \ \ \ \}}
\DoxyCodeLine{01694\ \ \ \ \ \textcolor{keywordflow}{return}\ leastSquaresResidual;}
\DoxyCodeLine{01695\ \}}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01697\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::solveGroupCacheFriendlySplitImpulseIterations(btCollisionObject**\ bodies,\ \textcolor{keywordtype}{int}\ numBodies,\ btPersistentManifold**\ manifoldPtr,\ \textcolor{keywordtype}{int}\ numManifolds,\ btTypedConstraint**\ constraints,\ \textcolor{keywordtype}{int}\ numConstraints,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ \mbox{\hyperlink{classbt_i_debug_draw}{btIDebugDraw}}*\ debugDrawer)}
\DoxyCodeLine{01698\ \{}
\DoxyCodeLine{01699\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}solveGroupCacheFriendlySplitImpulseIterations"{}});}
\DoxyCodeLine{01700\ \ \ \ \ \textcolor{keywordtype}{int}\ iteration;}
\DoxyCodeLine{01701\ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_splitImpulse)}
\DoxyCodeLine{01702\ \ \ \ \ \{}
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01704\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (iteration\ =\ 0;\ iteration\ <\ infoGlobal.m\_numIterations;\ iteration++)}
\DoxyCodeLine{01705\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ leastSquaresResidual\ =\ 0.f;}
\DoxyCodeLine{01707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numPoolConstraints\ =\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{01709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ j;}
\DoxyCodeLine{01710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ numPoolConstraints;\ j++)}
\DoxyCodeLine{01711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactConstraintPool[m\_orderTmpConstraintPool[j]];}
\DoxyCodeLine{01713\ }
\DoxyCodeLine{01714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ btScalar\ residual\ =\ resolveSplitPenetrationImpulse(m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdA],\ m\_tmpSolverBodyPool[solveManifold.m\_solverBodyIdB],\ solveManifold);}
\DoxyCodeLine{01715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leastSquaresResidual\ =\ btMax(leastSquaresResidual,\ residual\ *\ residual);}
\DoxyCodeLine{01716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leastSquaresResidual\ <=\ infoGlobal.m\_leastSquaresResidualThreshold\ ||\ iteration\ >=\ (infoGlobal.m\_numIterations\ -\/\ 1))}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01720\ \textcolor{preprocessor}{\#ifdef\ VERBOSE\_RESIDUAL\_PRINTF}}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}residual\ =\ \%f\ at\ iteration\ \#\%d\(\backslash\)n"{}},\ leastSquaresResidual,\ iteration);}
\DoxyCodeLine{01722\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01725\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01726\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01727\ \ \ \ \ \}}
\DoxyCodeLine{01728\ \}}
\DoxyCodeLine{01729\ }
\DoxyCodeLine{01730\ btScalar\ btSequentialImpulseConstraintSolver::solveGroupCacheFriendlyIterations(btCollisionObject**\ bodies,\ \textcolor{keywordtype}{int}\ numBodies,\ btPersistentManifold**\ manifoldPtr,\ \textcolor{keywordtype}{int}\ numManifolds,\ btTypedConstraint**\ constraints,\ \textcolor{keywordtype}{int}\ numConstraints,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ \mbox{\hyperlink{classbt_i_debug_draw}{btIDebugDraw}}*\ debugDrawer)}
\DoxyCodeLine{01731\ \{}
\DoxyCodeLine{01732\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}solveGroupCacheFriendlyIterations"{}});}
\DoxyCodeLine{01733\ }
\DoxyCodeLine{01734\ \ \ \ \ \{}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ solveGroupCacheFriendlySplitImpulseIterations(bodies,\ numBodies,\ manifoldPtr,\ numManifolds,\ constraints,\ numConstraints,\ infoGlobal,\ debugDrawer);}
\DoxyCodeLine{01737\ }
\DoxyCodeLine{01738\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ maxIterations\ =\ m\_maxOverrideNumSolverIterations\ >\ infoGlobal.m\_numIterations\ ?\ m\_maxOverrideNumSolverIterations\ :\ infoGlobal.m\_numIterations;}
\DoxyCodeLine{01739\ }
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ iteration\ =\ 0;\ iteration\ <\ maxIterations;\ iteration++)}
\DoxyCodeLine{01741\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//for\ (\ int\ iteration\ =\ maxIterations-\/1\ \ ;\ iteration\ >=\ 0;iteration-\/-\/)}}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01743\ \ \ \ \ \ \ \ \ \ \ \ \ m\_leastSquaresResidual\ =\ solveSingleIteration(iteration,\ bodies,\ numBodies,\ manifoldPtr,\ numManifolds,\ constraints,\ numConstraints,\ infoGlobal,\ debugDrawer);}
\DoxyCodeLine{01744\ }
\DoxyCodeLine{01745\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_leastSquaresResidual\ <=\ infoGlobal.m\_leastSquaresResidualThreshold\ ||\ (iteration\ >=\ (maxIterations\ -\/\ 1)))}
\DoxyCodeLine{01746\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01747\ \textcolor{preprocessor}{\#ifdef\ VERBOSE\_RESIDUAL\_PRINTF}}
\DoxyCodeLine{01748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}residual\ =\ \%f\ at\ iteration\ \#\%d\(\backslash\)n"{}},\ m\_leastSquaresResidual,\ iteration);}
\DoxyCodeLine{01749\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_numSolverCalls++;}
\DoxyCodeLine{01751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_numIterationsUsed\ =\ iteration+1;}
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_islandId\ =\ -\/2;}
\DoxyCodeLine{01753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (numBodies>0)}
\DoxyCodeLine{01754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_islandId\ =\ bodies[0]-\/>getCompanionId();}
\DoxyCodeLine{01755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_numBodies\ =\ numBodies;}
\DoxyCodeLine{01756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_numContactManifolds\ =\ numManifolds;}
\DoxyCodeLine{01757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_analyticsData.m\_remainingLeastSquaresResidual\ =\ m\_leastSquaresResidual;}
\DoxyCodeLine{01758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01759\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01760\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01761\ \ \ \ \ \}}
\DoxyCodeLine{01762\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.f;}
\DoxyCodeLine{01763\ \}}
\DoxyCodeLine{01764\ }
\DoxyCodeLine{01765\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::writeBackContacts(\textcolor{keywordtype}{int}\ iBegin,\ \textcolor{keywordtype}{int}\ iEnd,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01766\ \{}
\DoxyCodeLine{01767\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ iBegin;\ j\ <\ iEnd;\ j++)}
\DoxyCodeLine{01768\ \ \ \ \ \{}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btSolverConstraint\&\ solveManifold\ =\ m\_tmpSolverContactConstraintPool[j];}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}*\ pt\ =\ (\mbox{\hyperlink{classbt_manifold_point}{btManifoldPoint}}*)solveManifold.m\_originalContactPoint;}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \ \ btAssert(pt);}
\DoxyCodeLine{01772\ \ \ \ \ \ \ \ \ pt-\/>m\_appliedImpulse\ =\ solveManifold.m\_appliedImpulse;}
\DoxyCodeLine{01773\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ float\ f\ =\ m\_tmpSolverContactFrictionConstraintPool[solveManifold.m\_frictionIndex].m\_appliedImpulse;}}
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ printf("{}pt-\/>m\_appliedImpulseLateral1\ =\ \%f\(\backslash\)n"{},\ f);}}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ pt-\/>m\_appliedImpulseLateral1\ =\ m\_tmpSolverContactFrictionConstraintPool[solveManifold.m\_frictionIndex].m\_appliedImpulse;}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ \textcolor{comment}{//printf("{}pt-\/>m\_appliedImpulseLateral1\ =\ \%f\(\backslash\)n"{},\ pt-\/>m\_appliedImpulseLateral1);}}
\DoxyCodeLine{01777\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_2\_FRICTION\_DIRECTIONS))}
\DoxyCodeLine{01778\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \ \ \ \ pt-\/>m\_appliedImpulseLateral2\ =\ m\_tmpSolverContactFrictionConstraintPool[solveManifold.m\_frictionIndex\ +\ 1].m\_appliedImpulse;}
\DoxyCodeLine{01780\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \textcolor{comment}{//do\ a\ callback\ here?}}
\DoxyCodeLine{01782\ \ \ \ \ \}}
\DoxyCodeLine{01783\ \}}
\DoxyCodeLine{01784\ }
\DoxyCodeLine{01785\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::writeBackJoints(\textcolor{keywordtype}{int}\ iBegin,\ \textcolor{keywordtype}{int}\ iEnd,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01786\ \{}
\DoxyCodeLine{01787\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ iBegin;\ j\ <\ iEnd;\ j++)}
\DoxyCodeLine{01788\ \ \ \ \ \{}
\DoxyCodeLine{01789\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ btSolverConstraint\&\ solverConstr\ =\ m\_tmpSolverNonContactConstraintPool[j];}
\DoxyCodeLine{01790\ \ \ \ \ \ \ \ \ btTypedConstraint*\ constr\ =\ (btTypedConstraint*)solverConstr.m\_originalContactPoint;}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ btJointFeedback*\ fb\ =\ constr-\/>getJointFeedback();}
\DoxyCodeLine{01792\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fb)}
\DoxyCodeLine{01793\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01794\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedForceBodyA\ +=\ solverConstr.m\_contactNormal1\ *\ solverConstr.m\_appliedImpulse\ *\ constr-\/>getRigidBodyA().getLinearFactor()\ /\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{01795\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedForceBodyB\ +=\ solverConstr.m\_contactNormal2\ *\ solverConstr.m\_appliedImpulse\ *\ constr-\/>getRigidBodyB().getLinearFactor()\ /\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{01796\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedTorqueBodyA\ +=\ solverConstr.m\_relpos1CrossNormal\ *\ constr-\/>getRigidBodyA().getAngularFactor()\ *\ solverConstr.m\_appliedImpulse\ /\ infoGlobal.m\_timeStep;}
\DoxyCodeLine{01797\ \ \ \ \ \ \ \ \ \ \ \ \ fb-\/>m\_appliedTorqueBodyB\ +=\ solverConstr.m\_relpos2CrossNormal\ *\ constr-\/>getRigidBodyB().getAngularFactor()\ *\ solverConstr.m\_appliedImpulse\ /\ infoGlobal.m\_timeStep;\ \textcolor{comment}{/*RGM\ ????\ */}}
\DoxyCodeLine{01798\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01799\ }
\DoxyCodeLine{01800\ \ \ \ \ \ \ \ \ constr-\/>internalSetAppliedImpulse(solverConstr.m\_appliedImpulse);}
\DoxyCodeLine{01801\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (btFabs(solverConstr.m\_appliedImpulse)\ >=\ constr-\/>getBreakingImpulseThreshold())}
\DoxyCodeLine{01802\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01803\ \ \ \ \ \ \ \ \ \ \ \ \ constr-\/>setEnabled(\textcolor{keyword}{false});}
\DoxyCodeLine{01804\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01805\ \ \ \ \ \}}
\DoxyCodeLine{01806\ \}}
\DoxyCodeLine{01807\ }
\DoxyCodeLine{01808\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::writeBackBodies(\textcolor{keywordtype}{int}\ iBegin,\ \textcolor{keywordtype}{int}\ iEnd,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01809\ \{}
\DoxyCodeLine{01810\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ iBegin;\ i\ <\ iEnd;\ i++)}
\DoxyCodeLine{01811\ \ \ \ \ \{}
\DoxyCodeLine{01812\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_rigid_body}{btRigidBody}}*\ body\ =\ m\_tmpSolverBodyPool[i].m\_originalBody;}
\DoxyCodeLine{01813\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (body)}
\DoxyCodeLine{01814\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01815\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_splitImpulse)}
\DoxyCodeLine{01816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].writebackVelocityAndTransform(infoGlobal.m\_timeStep,\ infoGlobal.m\_splitImpulseTurnErp);}
\DoxyCodeLine{01817\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].writebackVelocity();}
\DoxyCodeLine{01819\ }
\DoxyCodeLine{01820\ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_originalBody-\/>setLinearVelocity(}
\DoxyCodeLine{01821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_linearVelocity\ +}
\DoxyCodeLine{01822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_externalForceImpulse);}
\DoxyCodeLine{01823\ }
\DoxyCodeLine{01824\ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_originalBody-\/>setAngularVelocity(}
\DoxyCodeLine{01825\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_angularVelocity\ +}
\DoxyCodeLine{01826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_externalTorqueImpulse);}
\DoxyCodeLine{01827\ }
\DoxyCodeLine{01828\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_splitImpulse)}
\DoxyCodeLine{01829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_originalBody-\/>setWorldTransform(m\_tmpSolverBodyPool[i].m\_worldTransform);}
\DoxyCodeLine{01830\ }
\DoxyCodeLine{01831\ \ \ \ \ \ \ \ \ \ \ \ \ m\_tmpSolverBodyPool[i].m\_originalBody-\/>setCompanionId(-\/1);}
\DoxyCodeLine{01832\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01833\ \ \ \ \ \}}
\DoxyCodeLine{01834\ \}}
\DoxyCodeLine{01835\ }
\DoxyCodeLine{01836\ btScalar\ btSequentialImpulseConstraintSolver::solveGroupCacheFriendlyFinish(btCollisionObject**\ bodies,\ \textcolor{keywordtype}{int}\ numBodies,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal)}
\DoxyCodeLine{01837\ \{}
\DoxyCodeLine{01838\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}solveGroupCacheFriendlyFinish"{}});}
\DoxyCodeLine{01839\ }
\DoxyCodeLine{01840\ \ \ \ \ \textcolor{keywordflow}{if}\ (infoGlobal.m\_solverMode\ \&\ SOLVER\_USE\_WARMSTARTING)}
\DoxyCodeLine{01841\ \ \ \ \ \{}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ writeBackContacts(0,\ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}(),\ infoGlobal);}
\DoxyCodeLine{01843\ \ \ \ \ \}}
\DoxyCodeLine{01844\ }
\DoxyCodeLine{01845\ \ \ \ \ writeBackJoints(0,\ m\_tmpSolverNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}(),\ infoGlobal);}
\DoxyCodeLine{01846\ \ \ \ \ writeBackBodies(0,\ m\_tmpSolverBodyPool.size(),\ infoGlobal);}
\DoxyCodeLine{01847\ }
\DoxyCodeLine{01848\ \ \ \ \ m\_tmpSolverContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(0);}
\DoxyCodeLine{01849\ \ \ \ \ m\_tmpSolverNonContactConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(0);}
\DoxyCodeLine{01850\ \ \ \ \ m\_tmpSolverContactFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(0);}
\DoxyCodeLine{01851\ \ \ \ \ m\_tmpSolverContactRollingFrictionConstraintPool.\mbox{\hyperlink{classbt_aligned_object_array_a2cc58c74534181a7a10e5c6ab8b21227}{resizeNoInitialize}}(0);}
\DoxyCodeLine{01852\ }
\DoxyCodeLine{01853\ \ \ \ \ m\_tmpSolverBodyPool.resizeNoInitialize(0);}
\DoxyCodeLine{01854\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.f;}
\DoxyCodeLine{01855\ \}}
\DoxyCodeLine{01856\ }
\DoxyCodeLine{01858\ btScalar\ btSequentialImpulseConstraintSolver::solveGroup(btCollisionObject**\ bodies,\ \textcolor{keywordtype}{int}\ numBodies,\ btPersistentManifold**\ manifoldPtr,\ \textcolor{keywordtype}{int}\ numManifolds,\ btTypedConstraint**\ constraints,\ \textcolor{keywordtype}{int}\ numConstraints,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ infoGlobal,\ \mbox{\hyperlink{classbt_i_debug_draw}{btIDebugDraw}}*\ debugDrawer,\ \mbox{\hyperlink{classbt_dispatcher}{btDispatcher}}*\ \textcolor{comment}{/*dispatcher*/})}
\DoxyCodeLine{01859\ \{}
\DoxyCodeLine{01860\ \ \ \ \ BT\_PROFILE(\textcolor{stringliteral}{"{}solveGroup"{}});}
\DoxyCodeLine{01861\ \ \ \ \ \textcolor{comment}{//you\ need\ to\ provide\ at\ least\ some\ bodies}}
\DoxyCodeLine{01862\ }
\DoxyCodeLine{01863\ \ \ \ \ solveGroupCacheFriendlySetup(bodies,\ numBodies,\ manifoldPtr,\ numManifolds,\ constraints,\ numConstraints,\ infoGlobal,\ debugDrawer);}
\DoxyCodeLine{01864\ }
\DoxyCodeLine{01865\ \ \ \ \ solveGroupCacheFriendlyIterations(bodies,\ numBodies,\ manifoldPtr,\ numManifolds,\ constraints,\ numConstraints,\ infoGlobal,\ debugDrawer);}
\DoxyCodeLine{01866\ }
\DoxyCodeLine{01867\ \ \ \ \ solveGroupCacheFriendlyFinish(bodies,\ numBodies,\ infoGlobal);}
\DoxyCodeLine{01868\ }
\DoxyCodeLine{01869\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.f;}
\DoxyCodeLine{01870\ \}}
\DoxyCodeLine{01871\ }
\DoxyCodeLine{01872\ \textcolor{keywordtype}{void}\ btSequentialImpulseConstraintSolver::reset()}
\DoxyCodeLine{01873\ \{}
\DoxyCodeLine{01874\ \ \ \ \ m\_btSeed2\ =\ 0;}
\DoxyCodeLine{01875\ \}}

\end{DoxyCode}
