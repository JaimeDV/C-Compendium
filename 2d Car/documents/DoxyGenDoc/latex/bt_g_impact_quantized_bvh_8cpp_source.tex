\doxysection{bt\+GImpact\+Quantized\+Bvh.\+cpp}
\hypertarget{bt_g_impact_quantized_bvh_8cpp_source}{}\label{bt_g_impact_quantized_bvh_8cpp_source}\index{C:/Users/Usuario/Documents/pruebas-\/c/Practica Animación/libraries/bullet-\/3.17/src/BulletCollision/Gimpact/btGImpactQuantizedBvh.cpp@{C:/Users/Usuario/Documents/pruebas-\/c/Practica Animación/libraries/bullet-\/3.17/src/BulletCollision/Gimpact/btGImpactQuantizedBvh.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00004\ \textcolor{comment}{/*}}
\DoxyCodeLine{00005\ \textcolor{comment}{This\ source\ file\ is\ part\ of\ GIMPACT\ Library.}}
\DoxyCodeLine{00006\ \textcolor{comment}{}}
\DoxyCodeLine{00007\ \textcolor{comment}{For\ the\ latest\ info,\ see\ http://gimpact.sourceforge.net/}}
\DoxyCodeLine{00008\ \textcolor{comment}{}}
\DoxyCodeLine{00009\ \textcolor{comment}{Copyright\ (c)\ 2007\ Francisco\ Leon\ Najera.\ C.C.\ 80087371.}}
\DoxyCodeLine{00010\ \textcolor{comment}{email:\ projectileman@yahoo.com}}
\DoxyCodeLine{00011\ \textcolor{comment}{}}
\DoxyCodeLine{00012\ \textcolor{comment}{}}
\DoxyCodeLine{00013\ \textcolor{comment}{This\ software\ is\ provided\ 'as-\/is',\ without\ any\ express\ or\ implied\ warranty.}}
\DoxyCodeLine{00014\ \textcolor{comment}{In\ no\ event\ will\ the\ authors\ be\ held\ liable\ for\ any\ damages\ arising\ from\ the\ use\ of\ this\ software.}}
\DoxyCodeLine{00015\ \textcolor{comment}{Permission\ is\ granted\ to\ anyone\ to\ use\ this\ software\ for\ any\ purpose,}}
\DoxyCodeLine{00016\ \textcolor{comment}{including\ commercial\ applications,\ and\ to\ alter\ it\ and\ redistribute\ it\ freely,}}
\DoxyCodeLine{00017\ \textcolor{comment}{subject\ to\ the\ following\ restrictions:}}
\DoxyCodeLine{00018\ \textcolor{comment}{}}
\DoxyCodeLine{00019\ \textcolor{comment}{1.\ The\ origin\ of\ this\ software\ must\ not\ be\ misrepresented;\ you\ must\ not\ claim\ that\ you\ wrote\ the\ original\ software.\ If\ you\ use\ this\ software\ in\ a\ product,\ an\ acknowledgment\ in\ the\ product\ documentation\ would\ be\ appreciated\ but\ is\ not\ required.}}
\DoxyCodeLine{00020\ \textcolor{comment}{2.\ Altered\ source\ versions\ must\ be\ plainly\ marked\ as\ such,\ and\ must\ not\ be\ misrepresented\ as\ being\ the\ original\ software.}}
\DoxyCodeLine{00021\ \textcolor{comment}{3.\ This\ notice\ may\ not\ be\ removed\ or\ altered\ from\ any\ source\ distribution.}}
\DoxyCodeLine{00022\ \textcolor{comment}{*/}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_g_impact_quantized_bvh_8h}{btGImpactQuantizedBvh.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}LinearMath/btQuickprof.h"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#ifdef\ TRI\_COLLISION\_PROFILING}}
\DoxyCodeLine{00028\ \mbox{\hyperlink{classbt_clock}{btClock}}\ g\_q\_tree\_clock;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keywordtype}{float}\ g\_q\_accum\_tree\_collision\_time\ =\ 0;}
\DoxyCodeLine{00031\ \textcolor{keywordtype}{int}\ g\_q\_count\_traversing\ =\ 0;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keywordtype}{void}\ bt\_begin\_gim02\_q\_tree\_time()}
\DoxyCodeLine{00034\ \{}
\DoxyCodeLine{00035\ \ \ \ \ g\_q\_tree\_clock.\mbox{\hyperlink{classbt_clock_a592eb764c2e7b645c9619ab7e483166c}{reset}}();}
\DoxyCodeLine{00036\ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keywordtype}{void}\ bt\_end\_gim02\_q\_tree\_time()}
\DoxyCodeLine{00039\ \{}
\DoxyCodeLine{00040\ \ \ \ \ g\_q\_accum\_tree\_collision\_time\ +=\ g\_q\_tree\_clock.\mbox{\hyperlink{classbt_clock_aa58b76bfde0b0f3f33d0cb91ec6b6938}{getTimeMicroseconds}}();}
\DoxyCodeLine{00041\ \ \ \ \ g\_q\_count\_traversing++;}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00045\ \textcolor{keywordtype}{float}\ btGImpactQuantizedBvh::getAverageTreeCollisionTime()}
\DoxyCodeLine{00046\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{if}\ (g\_q\_count\_traversing\ ==\ 0)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{float}\ avgtime\ =\ g\_q\_accum\_tree\_collision\_time;}
\DoxyCodeLine{00050\ \ \ \ \ avgtime\ /=\ (float)g\_q\_count\_traversing;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ g\_q\_accum\_tree\_collision\_time\ =\ 0;}
\DoxyCodeLine{00053\ \ \ \ \ g\_q\_count\_traversing\ =\ 0;}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{return}\ avgtime;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ \ float\ avgtime\ =\ g\_q\_count\_traversing;}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ \ g\_q\_count\_traversing\ =\ 0;}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ \ return\ avgtime;}}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//TRI\_COLLISION\_PROFILING}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keywordtype}{void}\ btQuantizedBvhTree::calc\_quantization(}
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{class_g_i_m___b_v_h___d_a_t_a___a_r_r_a_y}{GIM\_BVH\_DATA\_ARRAY}}\&\ primitive\_boxes,\ btScalar\ boundMargin)}
\DoxyCodeLine{00067\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//calc\ globa\ box}}
\DoxyCodeLine{00069\ \ \ \ \ btAABB\ global\_bound;}
\DoxyCodeLine{00070\ \ \ \ \ global\_bound.invalidate();}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ primitive\_boxes.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ i++)}
\DoxyCodeLine{00073\ \ \ \ \ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ global\_bound.merge(primitive\_boxes[i].m\_bound);}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ bt\_calc\_quantization\_parameters(}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ m\_global\_bound.m\_min,\ m\_global\_bound.m\_max,\ m\_bvhQuantization,\ global\_bound.m\_min,\ global\_bound.m\_max,\ boundMargin);}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \textcolor{keywordtype}{int}\ btQuantizedBvhTree::\_calc\_splitting\_axis(}
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{class_g_i_m___b_v_h___d_a_t_a___a_r_r_a_y}{GIM\_BVH\_DATA\_ARRAY}}\&\ primitive\_boxes,\ \textcolor{keywordtype}{int}\ startIndex,\ \textcolor{keywordtype}{int}\ endIndex)}
\DoxyCodeLine{00083\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ btVector3\ means(btScalar(0.),\ btScalar(0.),\ btScalar(0.));}
\DoxyCodeLine{00087\ \ \ \ \ btVector3\ variance(btScalar(0.),\ btScalar(0.),\ btScalar(0.));}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{int}\ numIndices\ =\ endIndex\ -\/\ startIndex;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ startIndex;\ i\ <\ endIndex;\ i++)}
\DoxyCodeLine{00091\ \ \ \ \ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ btVector3\ center\ =\ btScalar(0.5)\ *\ (primitive\_boxes[i].m\_bound.m\_max\ +}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ primitive\_boxes[i].m\_bound.m\_min);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ means\ +=\ center;}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \ \ means\ *=\ (btScalar(1.)\ /\ (btScalar)numIndices);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ startIndex;\ i\ <\ endIndex;\ i++)}
\DoxyCodeLine{00099\ \ \ \ \ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ btVector3\ center\ =\ btScalar(0.5)\ *\ (primitive\_boxes[i].m\_bound.m\_max\ +}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ primitive\_boxes[i].m\_bound.m\_min);}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ btVector3\ diff2\ =\ center\ -\/\ means;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ diff2\ =\ diff2\ *\ diff2;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ variance\ +=\ diff2;}
\DoxyCodeLine{00105\ \ \ \ \ \}}
\DoxyCodeLine{00106\ \ \ \ \ variance\ *=\ (btScalar(1.)\ /\ ((btScalar)numIndices\ -\/\ 1));}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordflow}{return}\ variance.maxAxis();}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \textcolor{keywordtype}{int}\ btQuantizedBvhTree::\_sort\_and\_calc\_splitting\_index(}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{class_g_i_m___b_v_h___d_a_t_a___a_r_r_a_y}{GIM\_BVH\_DATA\_ARRAY}}\&\ primitive\_boxes,\ \textcolor{keywordtype}{int}\ startIndex,}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{int}\ endIndex,\ \textcolor{keywordtype}{int}\ splitAxis)}
\DoxyCodeLine{00114\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{int}\ splitIndex\ =\ startIndex;}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{int}\ numIndices\ =\ endIndex\ -\/\ startIndex;}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ average\ of\ centers}}
\DoxyCodeLine{00120\ \ \ \ \ btScalar\ splitValue\ =\ 0.0f;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ btVector3\ means(btScalar(0.),\ btScalar(0.),\ btScalar(0.));}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ startIndex;\ i\ <\ endIndex;\ i++)}
\DoxyCodeLine{00124\ \ \ \ \ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ btVector3\ center\ =\ btScalar(0.5)\ *\ (primitive\_boxes[i].m\_bound.m\_max\ +}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ primitive\_boxes[i].m\_bound.m\_min);}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ means\ +=\ center;}
\DoxyCodeLine{00128\ \ \ \ \ \}}
\DoxyCodeLine{00129\ \ \ \ \ means\ *=\ (btScalar(1.)\ /\ (btScalar)numIndices);}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ splitValue\ =\ means[splitAxis];}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//sort\ leafNodes\ so\ all\ values\ larger\ then\ splitValue\ comes\ first,\ and\ smaller\ values\ start\ from\ 'splitIndex'.}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ startIndex;\ i\ <\ endIndex;\ i++)}
\DoxyCodeLine{00135\ \ \ \ \ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ btVector3\ center\ =\ btScalar(0.5)\ *\ (primitive\_boxes[i].m\_bound.m\_max\ +}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ primitive\_boxes[i].m\_bound.m\_min);}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (center[splitAxis]\ >\ splitValue)}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//swap}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ primitive\_boxes.swap(i,\ splitIndex);}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//swapLeafNodes(i,splitIndex);}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ splitIndex++;}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//if\ the\ splitIndex\ causes\ unbalanced\ trees,\ fix\ this\ by\ using\ the\ center\ in\ between\ startIndex\ and\ endIndex}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//otherwise\ the\ tree-\/building\ might\ fail\ due\ to\ stack-\/overflows\ in\ certain\ cases.}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//unbalanced1\ is\ unsafe:\ it\ can\ cause\ stack\ overflows}}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//bool\ unbalanced1\ =\ ((splitIndex==startIndex)\ ||\ (splitIndex\ ==\ (endIndex-\/1)));}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//unbalanced2\ should\ work\ too:\ always\ use\ center\ (perfect\ balanced\ trees)}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//bool\ unbalanced2\ =\ true;}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//this\ should\ be\ safe\ too:}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{int}\ rangeBalancedIndices\ =\ numIndices\ /\ 3;}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{bool}\ unbalanced\ =\ ((splitIndex\ <=\ (startIndex\ +\ rangeBalancedIndices))\ ||\ (splitIndex\ >=\ (endIndex\ -\/\ 1\ -\/\ rangeBalancedIndices)));}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{if}\ (unbalanced)}
\DoxyCodeLine{00160\ \ \ \ \ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ splitIndex\ =\ startIndex\ +\ (numIndices\ >>\ 1);}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ btAssert(!((splitIndex\ ==\ startIndex)\ ||\ (splitIndex\ ==\ (endIndex))));}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{return}\ splitIndex;}
\DoxyCodeLine{00167\ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \textcolor{keywordtype}{void}\ btQuantizedBvhTree::\_build\_sub\_tree(\mbox{\hyperlink{class_g_i_m___b_v_h___d_a_t_a___a_r_r_a_y}{GIM\_BVH\_DATA\_ARRAY}}\&\ primitive\_boxes,\ \textcolor{keywordtype}{int}\ startIndex,\ \textcolor{keywordtype}{int}\ endIndex)}
\DoxyCodeLine{00170\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordtype}{int}\ curIndex\ =\ m\_num\_nodes;}
\DoxyCodeLine{00172\ \ \ \ \ m\_num\_nodes++;}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ btAssert((endIndex\ -\/\ startIndex)\ >\ 0);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{if}\ ((endIndex\ -\/\ startIndex)\ ==\ 1)}
\DoxyCodeLine{00177\ \ \ \ \ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{comment}{//We\ have\ a\ leaf\ node}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ setNodeBound(curIndex,\ primitive\_boxes[startIndex].m\_bound);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ m\_node\_array[curIndex].setDataIndex(primitive\_boxes[startIndex].m\_data);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{//calculate\ Best\ Splitting\ Axis\ and\ where\ to\ split\ it.\ Sort\ the\ incoming\ 'leafNodes'\ array\ within\ range\ 'startIndex/endIndex'.}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//split\ axis}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{int}\ splitIndex\ =\ \_calc\_splitting\_axis(primitive\_boxes,\ startIndex,\ endIndex);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ splitIndex\ =\ \_sort\_and\_calc\_splitting\_index(}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ primitive\_boxes,\ startIndex,\ endIndex,}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ splitIndex\ \ \textcolor{comment}{//split\ axis}}
\DoxyCodeLine{00192\ \ \ \ \ );}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//calc\ this\ node\ bounding\ box}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ btAABB\ node\_bound;}
\DoxyCodeLine{00197\ \ \ \ \ node\_bound.invalidate();}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ startIndex;\ i\ <\ endIndex;\ i++)}
\DoxyCodeLine{00200\ \ \ \ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ node\_bound.merge(primitive\_boxes[i].m\_bound);}
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ setNodeBound(curIndex,\ node\_bound);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{comment}{//build\ left\ branch}}
\DoxyCodeLine{00207\ \ \ \ \ \_build\_sub\_tree(primitive\_boxes,\ startIndex,\ splitIndex);}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{comment}{//build\ right\ branch}}
\DoxyCodeLine{00210\ \ \ \ \ \_build\_sub\_tree(primitive\_boxes,\ splitIndex,\ endIndex);}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ m\_node\_array[curIndex].setEscapeIndex(m\_num\_nodes\ -\/\ curIndex);}
\DoxyCodeLine{00213\ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00216\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_quantized_bvh_tree_aa2229fd3e3e2004cdf8151437535e936}{btQuantizedBvhTree::build\_tree}}(}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{class_g_i_m___b_v_h___d_a_t_a___a_r_r_a_y}{GIM\_BVH\_DATA\_ARRAY}}\&\ primitive\_boxes)}
\DoxyCodeLine{00218\ \{}
\DoxyCodeLine{00219\ \ \ \ \ calc\_quantization(primitive\_boxes);}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ initialize\ node\ count\ to\ 0}}
\DoxyCodeLine{00221\ \ \ \ \ m\_num\_nodes\ =\ 0;}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{comment}{//\ allocate\ nodes}}
\DoxyCodeLine{00223\ \ \ \ \ m\_node\_array.resize(primitive\_boxes.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}()\ *\ 2);}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \_build\_sub\_tree(primitive\_boxes,\ 0,\ primitive\_boxes.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}());}
\DoxyCodeLine{00226\ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \textcolor{keywordtype}{void}\ btGImpactQuantizedBvh::refit()}
\DoxyCodeLine{00231\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordtype}{int}\ nodecount\ =\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a7d64ae990f07eab20cc43f87712db935}{getNodeCount}}();}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordflow}{while}\ (nodecount-\/-\/)}
\DoxyCodeLine{00234\ \ \ \ \ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isLeafNode(nodecount))}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ btAABB\ leafbox;}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ m\_primitive\_manager-\/>get\_primitive\_box(getNodeData(nodecount),\ leafbox);}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ setNodeBound(nodecount,\ leafbox);}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//const\ GIM\_BVH\_TREE\_NODE\ *\ nodepointer\ =\ get\_node\_pointer(nodecount);}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ left\ bound}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ btAABB\ bound;}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ bound.invalidate();}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ btAABB\ temp\_box;}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ child\_node\ =\ getLeftNode(nodecount);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child\_node)}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getNodeBound(child\_node,\ temp\_box);}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bound.merge(temp\_box);}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ child\_node\ =\ getRightNode(nodecount);}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child\_node)}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getNodeBound(child\_node,\ temp\_box);}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bound.merge(temp\_box);}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ setNodeBound(nodecount,\ bound);}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ \ \ \ \ \}}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00270\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a2f061fbf0c6d8a81438861be4add7968}{btGImpactQuantizedBvh::buildSet}}()}
\DoxyCodeLine{00271\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{comment}{//obtain\ primitive\ boxes}}
\DoxyCodeLine{00273\ \ \ \ \ \mbox{\hyperlink{class_g_i_m___b_v_h___d_a_t_a___a_r_r_a_y}{GIM\_BVH\_DATA\_ARRAY}}\ primitive\_boxes;}
\DoxyCodeLine{00274\ \ \ \ \ primitive\_boxes.resize(m\_primitive\_manager-\/>get\_primitive\_count());}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ primitive\_boxes.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ i++)}
\DoxyCodeLine{00277\ \ \ \ \ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ m\_primitive\_manager-\/>get\_primitive\_box(i,\ primitive\_boxes[i].m\_bound);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ primitive\_boxes[i].m\_data\ =\ i;}
\DoxyCodeLine{00280\ \ \ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ m\_box\_tree.\mbox{\hyperlink{classbt_quantized_bvh_tree_aa2229fd3e3e2004cdf8151437535e936}{build\_tree}}(primitive\_boxes);}
\DoxyCodeLine{00283\ \}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00286\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a4d2e0f3b36bf101f99b413632d6409a5}{btGImpactQuantizedBvh::boxQuery}}(\textcolor{keyword}{const}\ btAABB\&\ box,\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<int>}}\&\ collided\_results)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00287\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordtype}{int}\ curIndex\ =\ 0;}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordtype}{int}\ numNodes\ =\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a7d64ae990f07eab20cc43f87712db935}{getNodeCount}}();}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{comment}{//quantize\ box}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ quantizedMin[3];}
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ quantizedMax[3];}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ m\_box\_tree.quantizePoint(quantizedMin,\ box.m\_min);}
\DoxyCodeLine{00297\ \ \ \ \ m\_box\_tree.quantizePoint(quantizedMax,\ box.m\_max);}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{keywordflow}{while}\ (curIndex\ <\ numNodes)}
\DoxyCodeLine{00300\ \ \ \ \ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{comment}{//catch\ bugs\ in\ tree\ data}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ aabbOverlap\ =\ m\_box\_tree.testQuantizedBoxOverlapp(curIndex,\ quantizedMin,\ quantizedMax);}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isleafnode\ =\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a71171abb6f0c3b674ee885fc39aed215}{isLeafNode}}(curIndex);}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isleafnode\ \&\&\ aabbOverlap)}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ collided\_results.push\_back(getNodeData(curIndex));}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (aabbOverlap\ ||\ isleafnode)}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//next\ subnode}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ curIndex++;}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//skip\ node}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ curIndex\ +=\ getEscapeNodeIndex(curIndex);}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00321\ \ \ \ \ \}}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{keywordflow}{if}\ (collided\_results.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}()\ >\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00324\ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00327\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a0a97a57a30a5f014154e417f16390460}{btGImpactQuantizedBvh::rayQuery}}(}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{keyword}{const}\ btVector3\&\ ray\_dir,\ \textcolor{keyword}{const}\ btVector3\&\ ray\_origin,}
\DoxyCodeLine{00329\ \ \ \ \ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<int>}}\&\ collided\_results)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00330\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keywordtype}{int}\ curIndex\ =\ 0;}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordtype}{int}\ numNodes\ =\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a7d64ae990f07eab20cc43f87712db935}{getNodeCount}}();}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordflow}{while}\ (curIndex\ <\ numNodes)}
\DoxyCodeLine{00335\ \ \ \ \ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ btAABB\ bound;}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ getNodeBound(curIndex,\ bound);}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \textcolor{comment}{//catch\ bugs\ in\ tree\ data}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ aabbOverlap\ =\ bound.collide\_ray(ray\_origin,\ ray\_dir);}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isleafnode\ =\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh_a71171abb6f0c3b674ee885fc39aed215}{isLeafNode}}(curIndex);}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isleafnode\ \&\&\ aabbOverlap)}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ collided\_results.push\_back(getNodeData(curIndex));}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (aabbOverlap\ ||\ isleafnode)}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//next\ subnode}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ curIndex++;}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//skip\ node}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ curIndex\ +=\ getEscapeNodeIndex(curIndex);}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00359\ \ \ \ \ \}}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordflow}{if}\ (collided\_results.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}()\ >\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00362\ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ SIMD\_FORCE\_INLINE\ \textcolor{keywordtype}{bool}\ \_quantized\_node\_collision(}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh}{btGImpactQuantizedBvh}}*\ boxset0,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh}{btGImpactQuantizedBvh}}*\ boxset1,}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keyword}{const}\ BT\_BOX\_BOX\_TRANSFORM\_CACHE\&\ trans\_cache\_1to0,}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordtype}{int}\ node0,\ \textcolor{keywordtype}{int}\ node1,\ \textcolor{keywordtype}{bool}\ complete\_primitive\_tests)}
\DoxyCodeLine{00368\ \{}
\DoxyCodeLine{00369\ \ \ \ \ btAABB\ box0;}
\DoxyCodeLine{00370\ \ \ \ \ boxset0-\/>getNodeBound(node0,\ box0);}
\DoxyCodeLine{00371\ \ \ \ \ btAABB\ box1;}
\DoxyCodeLine{00372\ \ \ \ \ boxset1-\/>getNodeBound(node1,\ box1);}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keywordflow}{return}\ box0.overlapping\_trans\_cache(box1,\ trans\_cache\_1to0,\ complete\_primitive\_tests);}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{comment}{//\ \ box1.appy\_transform\_trans\_cache(trans\_cache\_1to0);}}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{comment}{//\ \ return\ box0.has\_collision(box1);}}
\DoxyCodeLine{00377\ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \textcolor{comment}{//stackless\ recursive\ collision\ routine}}
\DoxyCodeLine{00380\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh}{btGImpactQuantizedBvh}}*\ boxset0,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh}{btGImpactQuantizedBvh}}*\ boxset1,}
\DoxyCodeLine{00382\ \ \ \ \ \mbox{\hyperlink{classbt_pair_set}{btPairSet}}*\ collision\_pairs,}
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{keyword}{const}\ BT\_BOX\_BOX\_TRANSFORM\_CACHE\&\ trans\_cache\_1to0,}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keywordtype}{int}\ node0,\ \textcolor{keywordtype}{int}\ node1,\ \textcolor{keywordtype}{bool}\ complete\_primitive\_tests)}
\DoxyCodeLine{00385\ \{}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_quantized\_node\_collision(}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,\ trans\_cache\_1to0,}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ node0,\ node1,\ complete\_primitive\_tests)\ ==\ \textcolor{keyword}{false})\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//avoid\ colliding\ internal\ nodes}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{if}\ (boxset0-\/>\mbox{\hyperlink{classbt_g_impact_quantized_bvh_a71171abb6f0c3b674ee885fc39aed215}{isLeafNode}}(node0))}
\DoxyCodeLine{00391\ \ \ \ \ \{}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (boxset1-\/>\mbox{\hyperlink{classbt_g_impact_quantized_bvh_a71171abb6f0c3b674ee885fc39aed215}{isLeafNode}}(node1))}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ collision\ result}}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs-\/>push\_pair(}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getNodeData(node0),\ boxset1-\/>getNodeData(node1));}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ left\ recursive}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node0,\ boxset1-\/>getLeftNode(node1),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ right\ recursive}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node0,\ boxset1-\/>getRightNode(node1),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00414\ \ \ \ \ \}}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00416\ \ \ \ \ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (boxset1-\/>\mbox{\hyperlink{classbt_g_impact_quantized_bvh_a71171abb6f0c3b674ee885fc39aed215}{isLeafNode}}(node1))}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ left\ recursive}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getLeftNode(node0),\ node1,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ right\ recursive}}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getRightNode(node0),\ node1,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ left0\ left1}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getLeftNode(node0),\ boxset1-\/>getLeftNode(node1),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ left0\ right1}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getLeftNode(node0),\ boxset1-\/>getRightNode(node1),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ right0\ left1}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getRightNode(node0),\ boxset1-\/>getLeftNode(node1),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//collide\ right0\ right1}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collision\_pairs,\ trans\_cache\_1to0,}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxset0-\/>getRightNode(node0),\ boxset1-\/>getRightNode(node1),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \}\ \ \textcolor{comment}{//\ else\ if\ node1\ is\ not\ a\ leaf}}
\DoxyCodeLine{00463\ \ \ \ \ \}\ \ \ \ \ \ \textcolor{comment}{//\ else\ if\ node0\ is\ not\ a\ leaf}}
\DoxyCodeLine{00464\ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \textcolor{keywordtype}{void}\ btGImpactQuantizedBvh::find\_collision(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh}{btGImpactQuantizedBvh}}*\ boxset0,\ \textcolor{keyword}{const}\ btTransform\&\ trans0,}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_g_impact_quantized_bvh}{btGImpactQuantizedBvh}}*\ boxset1,\ \textcolor{keyword}{const}\ btTransform\&\ trans1,}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_pair_set}{btPairSet}}\&\ collision\_pairs)}
\DoxyCodeLine{00469\ \{}
\DoxyCodeLine{00470\ \ \ \ \ \textcolor{keywordflow}{if}\ (boxset0-\/>\mbox{\hyperlink{classbt_g_impact_quantized_bvh_a7d64ae990f07eab20cc43f87712db935}{getNodeCount}}()\ ==\ 0\ ||\ boxset1-\/>\mbox{\hyperlink{classbt_g_impact_quantized_bvh_a7d64ae990f07eab20cc43f87712db935}{getNodeCount}}()\ ==\ 0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \ \ BT\_BOX\_BOX\_TRANSFORM\_CACHE\ trans\_cache\_1to0;}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \ \ trans\_cache\_1to0.calc\_from\_homogenic(trans0,\ trans1);}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \textcolor{preprocessor}{\#ifdef\ TRI\_COLLISION\_PROFILING}}
\DoxyCodeLine{00477\ \ \ \ \ bt\_begin\_gim02\_q\_tree\_time();}
\DoxyCodeLine{00478\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//TRI\_COLLISION\_PROFILING}}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \ \ \_find\_quantized\_collision\_pairs\_recursive(}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ boxset0,\ boxset1,}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \&collision\_pairs,\ trans\_cache\_1to0,\ 0,\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00483\ \textcolor{preprocessor}{\#ifdef\ TRI\_COLLISION\_PROFILING}}
\DoxyCodeLine{00484\ \ \ \ \ bt\_end\_gim02\_q\_tree\_time();}
\DoxyCodeLine{00485\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//TRI\_COLLISION\_PROFILING}}
\DoxyCodeLine{00486\ \}}

\end{DoxyCode}
